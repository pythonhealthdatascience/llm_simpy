
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Automated Model Testing &#8212; Using Generative AI to Reconstruct Healthcare Simulation Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/03_stroke/02_model_stage2/02_auto_testing_stage2';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Manual model testing" href="03_manual_testing_stage2.html" />
    <link rel="prev" title="Full model code" href="01_asu_rehab_model.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../front_page.html">
  
  
  
  
  
  
    <p class="title logo__title">Using Generative AI to Reconstruct Healthcare Simulation Models</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../front_page.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Aims</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../00_introduction/01_primary.html">Primary aims</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_introduction/02_literature.html">Related literature</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/01_overview.html">Procedure overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/02_recreation.html">Model recreation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/03_case_studies.html">Case study selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/04_design.html">Model design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/05_prompt_engineering.html">Prompt Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/06_testing.html">Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Critical Care Model</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/00_stress_report.html">STRESS report</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/03_data.html">3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/06_code_access.html">6. Code access</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/01_model_stage1.html">Model Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/01_ccu_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/02_auto_testing.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/03_manual_testing.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/04_run_script.html">Run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/05_interface.html">Streamlit interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/06_sensitivity_analysis.html">Sensitivity Analysis Script</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/02_model_stage2.html">Model Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/02_model_stage2/01_ccu_model_stage2.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/02_model_stage2/02_auto_testing_stage2.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/02_model_stage2/03_manual_testing_stage2.html">Manual model testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_CCU/03_comparison.html">Model output comparison</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/04_prompts_stage1.html">Prompts Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/00_iteration.html">Iteration 0: unplanned arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/01_iteration.html">Iteration 1: treatment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/02_iteration.html">Iteration 2: elective patients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/03_iteration.html">Iteration 3: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/04_iteration.html">Iteration 4: warm-up period</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/05_iteration.html">Iteration 5: cancelled electives (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/06_iteration.html">Iteration 6: bed utilisation (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/07_iteration.html">Iteration 7: waiting time (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/08_iteration.html">Iteration 8: bed occupancy (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/09_iteration.html">Iteration 9: patient count (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/10_iteration.html">Iteration 10: multiple reps (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/11_iteration.html">Iteration 11: multiple reps (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/12_iteration.html">Iteration 12: multiple reps (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/13_iteration.html">Iteration 13: multiple reps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/14_iteration.html">Iteration 14: random number streams (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/15_iteration.html">Iteration 15: random number streams (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/16_iteration.html">Iteration 16: random number streams (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/17_iteration.html">Iteration 17: random number streams (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/18_iteration.html">Iteration 18: batching experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/19_iteration.html">Iteration 19: streamlit (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/20_iteration.html">Iteration 20: streamlit (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/21_iteration.html">Iteration 21: streamlit (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/22_iteration.html">Iteration 22: bug fix</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/05_prompts_stage2.html">Prompts Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/00_iteration_s2.html">Iteration 0: unplanned arrivals - stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/01_iteration_s2.html">Iteration 1: treatment - stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/02_iteration_s2.html">Iteration 2: elective patients - stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/03_iteration_s2.html">Iteration 3: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/04_iteration_s2.html">Iteration 4: warm-up period stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/05_iteration_s2.html">Iteration 5: cancelled electives (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/06_iteration_s2.html">Iteration 6: bed utilisation (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/07_iteration_s2.html">Iteration 7: waiting time (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/08_iteration_s2.html">Iteration 8: bed occupancy (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/09_iteration_s2.html">Iteration 9: patient count (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/10_iteration_s2.html">Iteration 10: multiple reps (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/11_iteration_s2.html">Iteration 11: multiple reps (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/12_iteration_s2.html">Iteration 12: multiple reps (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/13_iteration_s2.html">Iteration 13: multiple reps stage 2 (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/14_iteration_s2.html">Iteration 14: random number streams (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/15_iteration_s2.html">Iteration 15: random number streams (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/16_iteration_s2.html">Iteration 16: random number streams (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/17_iteration_s2.html">Iteration 17: random number streams (4) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/18_iteration_s2.html">Iteration 18: batching experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/19_iteration_s2.html">Iteration 19: streamlit (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/20_iteration_s2.html">Iteration 20: streamlit (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/21_iteration_s2.html">Iteration 21: streamlit (3) stage 2</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Stroke + Rehab model</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../00_stress_report.html">STRESS report</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/03_data.html">3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/06_code_access.html">6. Code access</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../01_model_stage1.html">Model Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_model_stage1/01_asu_rehab_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_model_stage1/02_auto_testing.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_model_stage1/03_manual_testing.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_model_stage1/04_run_script.html">Run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_model_stage1/05_interface.html">Streamlit interface</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../02_model_stage2.html">Model Stage 2</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_asu_rehab_model.html">Full model code</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_manual_testing_stage2.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_run_script_stage2.html">Run script</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../03_comparison.html">Model output comparison</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04_asu_rehab_prompts.html">Prompts stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/01_iteration.html">Iteration 1: Acute Stroke Unit Arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/02_iteration.html">Iteration 2: Post stroke unit destination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/03_iteration.html">Iteration 3: Sample length of stay on the ASU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/04_iteration.html">Iteration 4: Fix the sampling from lognormal distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/05_iteration.html">Iteration 5: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/06_iteration.html">Iteration 6: add in a count of occupancy.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/07_iteration.html">Iteration 7: a trace function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/08_iteration.html">Iteration 8: auditing ASU occupancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/09_iteration.html">Iteration 9: ASU occupancy plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/10_iteration.html">Iteration 10: Blocking probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/11_iteration.html">Iteration 11: Return missing code</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/12_iteration.html">Iteration 12: External Rehab arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/13_iteration.html">Iteration 13: Organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/14_iteration.html">Iteration 14: Rehab treatment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/15_iteration.html">Iteration 15: Organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/16_iteration.html">Iteration 16: TIA rehab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/17_iteration.html">Iteration 17: Count occupancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/18_iteration.html">Iteration 18: Audit Rehab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/19_iteration.html">Iteration 19: Link models (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/20_iteration.html">Iteration 20: Link models (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/21_iteration.html">Iteration 21: Warm-up period</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/22_iteration.html">Iteration 22: Multiple Replications (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/23_iteration.html">Iteration 23: Multiple Replications (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/24_iteration.html">Iteration 24: Common Random Numbers (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/25_iteration.html">Iteration 25: Common Random Numbers (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/26_iteration.html">Iteration 26: Common Random Numbers (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/27_iteration.html">Iteration 27: Common Random Numbers (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/28_iteration.html">Iteration 28: streamlit (1)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/29_iteration.html">Iteration 29: streamlit (2)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/30_iteration.html">Iteration 30: streamlit (3)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/31_iteration.html">Iteration 30: Bug fix</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../05_asu_rehab_prompts_stage2.html">Prompts stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/01_iteration_s2.html">Iteration 1: Acute Stroke Unit Arrivals stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/02_iteration_s2.html">Iteration 2: Post stroke unit destination stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/03_iteration_s2.html">Iteration 3: Sample length of stay on the ASU stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/04_iteration_s2.html">Iteration 4: Check the sampling from lognormal distributions stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/05_iteration_s2.html">Iteration 5: organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/06_iteration_s2.html">Iteration 6: add in a count of occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/07_iteration_s2.html">Iteration 7: a trace function stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/08_iteration_s2.html">Iteration 8: auditing ASU occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/09_iteration_s2.html">Iteration 9: ASU occupancy plot stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/10_iteration_s2.html">Iteration 10: Blocking probability stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/11_iteration_s2.html">Iteration 11: Return missing code stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/12_iteration_s2.html">Iteration 12: External Rehab arrivals stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/13_iteration_s2.html">Iteration 13: Organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/14_iteration_s2.html">Iteration 14: Rehab treatment stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/15_iteration_s2.html">Iteration 15: Organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/16_iteration_s2.html">Iteration 16: TIA rehab stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/17_iteration_s2.html">Iteration 17: Count occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/18_iteration_s2.html">Iteration 18: Audit Rehab stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/19_iteration_s2.html">Iteration 19: Link models (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/20_iteration_s2.html">Iteration 20: Link models (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/21_iteration_s2.html">Iteration 21: Warm-up period stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/22_iteration_s2.html">Iteration 22: Multiple Replications (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/23_iteration_s2.html">Iteration 23: Multiple Replications (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/24_iteration_s2.html">Iteration 24: Common Random Numbers (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/25_iteration_s2.html">Iteration 25: Common Random Numbers (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/26_iteration_s2.html">Iteration 26: Common Random Numbers (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/27_iteration_s2.html">Iteration 27: Common Random Numbers (4) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/28_iteration_s2.html">Iteration 28: streamlit (1) stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/29_iteration_s2.html">Iteration 29: streamlit (2) stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/30_iteration_s2.html">Iteration 30: streamlit (3)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/31_iteration_s2.html">Iteration 30: Bug fix</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Results</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../04_results/01_CCU/00_model_comparison.html">CCU models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_results/02_stroke/00_model_comparison.html">Stroke+Rehab models</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/pythonhealthdatascience/llm_simpy/main?urlpath=lab/tree/notebooks/03_stroke/02_model_stage2/02_auto_testing_stage2.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pythonhealthdatascience/llm_simpy" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pythonhealthdatascience/llm_simpy/issues/new?title=Issue%20on%20page%20%2Fnotebooks/03_stroke/02_model_stage2/02_auto_testing_stage2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/03_stroke/02_model_stage2/02_auto_testing_stage2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Automated Model Testing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tests">Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-processing">Results processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-collection-tests">Results collection tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-run-tests">Mode run tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-number-set-test-asu-only">Random number set test (ASU only)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lognormal-test">Lognormal test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extreme-value-tests">Extreme value tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-tracing-functionality">Test tracing functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plotting-functions">Test plotting functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-streamlit-app">Test streamlit app</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-the-patienttype-methods">Test the <code class="docutils literal notranslate"><span class="pre">PatientType</span></code> methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-summary-table">Test <code class="docutils literal notranslate"><span class="pre">summary_table</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-all-automated-tests">Run all automated tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage-report">Test coverage report</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="automated-model-testing">
<h1>Automated Model Testing<a class="headerlink" href="#automated-model-testing" title="Link to this heading">#</a></h1>
<p>This notebook contains a set of automated tests for the Stroke+Rehab model.  These tests are either pass or fail and no interpretation is needed. A summary of test results is provided at the end of the notebook.</p>
<p>The stroke rehab model is imported within each test function because coverage measurement must begin before the module is imported and executed. When modules are imported at the top level of the notebook, all function definitions (def statements) are executed before pytest-cov starts measuring coverage, causing them to potentially be reported as uncovered lines.</p>
<p><strong>Additional testing:</strong> Beyond the original test suite defined in our methodology, we’ve included extra tests to enhance validation and coverage, based on peer review feedback.</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">simpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lognormal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">streamlit.testing.v1</span><span class="w"> </span><span class="kn">import</span> <span class="n">AppTest</span>

<span class="n">ipytest</span><span class="o">.</span><span class="n">autoconfig</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formatting the coverage report</span>
<span class="n">module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">module_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">module_path</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">helper.format_coverage</span><span class="w"> </span><span class="kn">import</span> <span class="n">display_coverage</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Link to this heading">#</a></h2>
<section id="results-processing">
<h3>Results processing<a class="headerlink" href="#results-processing" title="Link to this heading">#</a></h3>
<p>A set of tests to check that the results of a simulated run are processed correctly for the user.</p>
<p>We test the processing of:</p>
<ul class="simple">
<li><p>occupancy frequencies</p></li>
<li><p>probability of delay</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;values, rel_expected, cum_expected&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> 
                           <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_result_processing_1</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">rel_expected</span><span class="p">,</span> <span class="n">cum_expected</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the `calculate_occupancy_frequencies` function works</span>
<span class="sd">    as expected.</span>

<span class="sd">    Expected result: relative frequencies and cumulative freqs</span>
<span class="sd">    are the same as expected values.</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    values: list</span>
<span class="sd">        list of values to test</span>

<span class="sd">    rel_expected: list</span>
<span class="sd">        list of floats - expected relative freqs</span>

<span class="sd">    cum_expected: list</span>
<span class="sd">        list of floats - expected cumulative freqs</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_occupancy_frequencies</span>

    <span class="n">rel</span><span class="p">,</span> <span class="n">cum</span><span class="p">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">calculate_occupancy_frequencies</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># use all close to allow for minor floating point differences.</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">rel_expected</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cum_expected</span><span class="p">),</span> <span class="n">cum</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;relative, cum, p_delay_expected&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                           <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="o">/</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="o">/</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">/</span><span class="mf">1.0</span><span class="p">])</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_result_processing_2</span><span class="p">(</span><span class="n">relative</span><span class="p">,</span> <span class="n">cum</span><span class="p">,</span> <span class="n">p_delay_expected</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the probability of delay is calculated correctly</span>
<span class="sd">    using the `calculate_prob_delay` function.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    relative: list</span>
<span class="sd">        list of floats - relative freqs</span>

<span class="sd">    cum: list</span>
<span class="sd">        list of floats - cumulative freqs</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the function pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_prob_delay</span>

    <span class="n">p_delay</span> <span class="o">=</span> <span class="n">calculate_prob_delay</span><span class="p">(</span><span class="n">relative</span><span class="p">,</span> <span class="n">cum</span><span class="p">)</span>
    <span class="c1"># use all close to allow for minor floating point differences.</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_delay_expected</span><span class="p">),</span> <span class="n">p_delay</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="results-collection-tests">
<h3>Results collection tests<a class="headerlink" href="#results-collection-tests" title="Link to this heading">#</a></h3>
<p>Test that the optional results collection processes for the ASU and REHAB models work correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">results_collection_test1</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the model collects acute stroke occupancy every day</span>

<span class="sd">    Expected result: len(experiment.asu_occupancy) == env.now</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the experiment</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">({</span>
        <span class="s1">&#39;run_length&#39;</span><span class="p">:</span> <span class="mi">365</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Run for 5 years</span>
        <span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Set to True if you want to see detailed logs</span>
        <span class="s1">&#39;acute_audit_interval&#39;</span><span class="p">:</span> <span class="n">audit_interval</span>  <span class="c1"># Audit interval as specified</span>
    <span class="p">})</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>

    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>

    <span class="c1"># Create the AcuteStrokeUnit</span>
    <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>

    <span class="c1"># modified iteration 21</span>
    <span class="c1"># start the audit_acute_occupancy to record ASU occupancy at intervals</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">asu</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>

    <span class="c1"># Run the model - modified iteration 21</span>
    <span class="n">asu</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of occupancy audits: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Simulation time: </span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># The number of audits should be equal to the simulation time</span>
    <span class="c1"># (assuming audit_interval=1 and the first audit happens at time 1)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_2</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the model collects rehab occupancy every day</span>

<span class="sd">    Expected result: len(experiment.rehab_occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>

    <span class="c1"># create experiment</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>
    
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>

    <span class="c1"># Start the audit process - modified iteration 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rehab_audit_interval&#39;</span><span class="p">],</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    
    <span class="c1"># Run the model for the default run length in the experiment - modified in iteration 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_system</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    SYSTEM TEST</span>
<span class="sd">    </span>
<span class="sd">    Test REHAB ward occupancy data collected is in a sensible range</span>
<span class="sd">    when it is connected to the ASU model.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: The type collected is int. The values are in </span>
<span class="sd">    the range in the range 1 to [10-15] with sensible moments.</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(experiment.asu_occupancy) == env.now - 1 AND</span>
<span class="sd">        len(experiment.rehab_occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Create an experiment with default parameters</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># Create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">asu</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Start the audit process - modified iteration 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rehab_audit_interval&#39;</span><span class="p">],</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;acute_audit_interval&#39;</span><span class="p">],</span> <span class="n">asu</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters - modified in iteration 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="c1"># Print info for debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average rehab occupancy: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum rehab occupancy: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum rehab occupancy: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="mode-run-tests">
<h2>Mode run tests<a class="headerlink" href="#mode-run-tests" title="Link to this heading">#</a></h2>
<p>Here we test that various modes of running the model work correctly.  These include</p>
<ul class="simple">
<li><p>results collection period</p></li>
<li><p>warm-up</p></li>
<li><p>single run mode</p></li>
<li><p>repeatable results using random number sets.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_system</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    SYSTEM TEST</span>
<span class="sd">    </span>
<span class="sd">    Test REHAB ward occupancy data collected is in a sensible range</span>
<span class="sd">    when it is connected to the ASU model.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: The type collected is int. The values are in </span>
<span class="sd">    the range in the range 1 to [10-15] with sensible moments.</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(experiment.asu_occupancy) == env.now - 1 AND</span>
<span class="sd">        len(experiment.rehab_occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Create an experiment with default parameters</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># Create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">asu</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Start the audit process - modified iteration 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rehab_audit_interval&#39;</span><span class="p">],</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;acute_audit_interval&#39;</span><span class="p">],</span> <span class="n">asu</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters - modified in iteration 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="c1"># Print info for debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average rehab occupancy: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum rehab occupancy: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum rehab occupancy: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;warm_up, audit_interval&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_warm_up</span><span class="p">(</span><span class="n">warm_up</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test warm-up works correctly for ASU+REHAB ward occupancy</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(experiment.asu_occupancy) == experiment.results_collection_period </span>
<span class="sd">        AND len(experiment.rehab_occupancy) == experiment.results_collection_period </span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the experiment with specified warm-up period</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">({</span>
        <span class="s1">&#39;warm_up&#39;</span><span class="p">:</span> <span class="n">warm_up</span><span class="p">,</span>
        <span class="s1">&#39;acute_audit_interval&#39;</span><span class="p">:</span> <span class="n">audit_interval</span><span class="p">,</span>
        <span class="s1">&#39;rehab_audit_interval&#39;</span><span class="p">:</span> <span class="n">audit_interval</span>
    <span class="p">})</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators</span>
    <span class="n">asu</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Start the REHAB patient generators</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Start the audit processes</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">warm_up</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">asu</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">warm_up</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">warm_up</span> <span class="o">+</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="c1"># Print info for debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;results_collection_period&quot;</span><span class="p">]</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">experiment</span><span class="o">.</span><span class="n">warm_up</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;results_collection_period&quot;</span><span class="p">]</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Test</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">]</span> <span class="ow">and</span> 
            <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_single_run</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the the single_run function returns a dictionary of </span>
<span class="sd">    results.</span>

<span class="sd">    The results dictionary contains the following keys:</span>

<span class="sd">    &#39;relative_freq_asu&#39;</span>
<span class="sd">    &#39;prob_delay_asu&#39;</span>
<span class="sd">    &#39;unique_vals_asu&#39;</span>
<span class="sd">    &#39;relative_freq_rehab&#39;</span>
<span class="sd">    &#39;prob_delay_rehab&#39;</span>
<span class="sd">    &#39;unique_vals_rehab&#39;</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(run_results) == 6 and type(run_results) == dict</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">single_run</span>

    <span class="c1"># a default experiment</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># run the model</span>
    <span class="n">run_results</span> <span class="o">=</span> <span class="n">single_run</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run_results</span><span class="p">[</span><span class="s1">&#39;relative_freq_asu&#39;</span><span class="p">]</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">run_results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</pre></div>
</div>
</div>
</div>
<section id="random-number-set-test-asu-only">
<h3>Random number set test (ASU only)<a class="headerlink" href="#random-number-set-test-asu-only" title="Link to this heading">#</a></h3>
<p>Test that ASU results are repeated each time the same random number set is used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;random_number_set, print_output&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_random_number_set_1</span><span class="p">(</span><span class="n">random_number_set</span><span class="p">,</span> <span class="n">print_output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the the ASU model produces repeatable results. </span>

<span class="sd">    Compares</span>
<span class="sd">    min, max, mean of occupancy.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: </span>
<span class="sd">        set(run1) == set(run2)</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        
        <span class="c1"># Create the simulation environment</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
        
        <span class="c1"># Initialize the Acute Stroke Unit model</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">random_number_set</span><span class="o">=</span><span class="n">random_number_set</span><span class="p">)</span>
    
        <span class="c1"># Add RU, but do not run the model</span>
        <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
        
        <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
        
        <span class="c1"># Start the patient generators</span>
        <span class="n">asu</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
        <span class="c1"># Start the audit_acute_occupancy generator function to record ASU occupancy at intervals</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">asu</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
        
        <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
        <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">print_output</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Run </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> results:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span> 
                            <span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span>
                            <span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">))))</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;random_number_set, print_output&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_random_number_set_2</span><span class="p">(</span><span class="n">random_number_set</span><span class="p">,</span> <span class="n">print_output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the the single_run function returns a dictionary of </span>
<span class="sd">    results.</span>

<span class="sd">    The results dictionary contains the following keys:</span>

<span class="sd">    &#39;relative_freq_asu&#39;</span>
<span class="sd">    &#39;prob_delay_asu&#39;</span>
<span class="sd">    &#39;unique_vals_asu&#39;</span>
<span class="sd">    &#39;relative_freq_rehab&#39;</span>
<span class="sd">    &#39;prob_delay_rehab&#39;</span>
<span class="sd">    &#39;unique_vals_rehab&#39;</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(run_results) == 6 and type(run_results) == dict</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">single_run</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    
        <span class="c1"># set a random number set for streams</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">random_number_set</span><span class="o">=</span><span class="n">random_number_set</span><span class="p">)</span>
    
        <span class="c1"># run the model</span>
        <span class="n">run_results</span> <span class="o">=</span> <span class="n">single_run</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_output</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Run </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> results:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span> 
                            <span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span>
                            <span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">))))</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lognormal-test">
<h3>Lognormal test<a class="headerlink" href="#lognormal-test" title="Link to this heading">#</a></h3>
<p>Test that lognomal function correctly calculates the moments of the underlying normal dist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;mean, std&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mf">128.79</span><span class="p">,</span> <span class="mf">267.51</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_lognormal_moments</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test that lognomal function correctly calculates </span>
<span class="sd">    the moments of the underlying normal dist.</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    mean: float</span>
<span class="sd">        mean of the lognormal distribution</span>

<span class="sd">    std: float</span>
<span class="sd">        st dev of the lognormal distribution</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Lognormal class from sim-tools.</span>
    <span class="n">expected_moments</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">expected_moments</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">expected_moments</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>

    <span class="c1"># Convert lognormal parameters from llm for asu</span>
    <span class="n">normal_mean</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mean</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">normal_std</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">std</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">mean</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">normal_mean</span><span class="p">,</span> <span class="n">normal_std</span><span class="p">)</span>

    <span class="c1"># Check llm lognormal function used in rehab model - changed in iteration 23</span>
    <span class="n">normal_mean2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">std</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">mean</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">normal_std2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">std</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">mean</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="n">normal_mean2</span><span class="p">,</span> <span class="n">normal_std2</span><span class="p">)</span>


    <span class="k">assert</span> <span class="p">(</span><span class="n">normal_mean</span><span class="p">,</span> <span class="n">normal_std</span><span class="p">)</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">((</span><span class="n">expected_moments</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">expected_moments</span><span class="o">.</span><span class="n">sigma</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="n">normal_mean2</span><span class="p">,</span> <span class="n">normal_std2</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
</section>
<section id="extreme-value-tests">
<h3>Extreme value tests<a class="headerlink" href="#extreme-value-tests" title="Link to this heading">#</a></h3>
<p>Extreme value tests are used pragmatically to block of routes/arrivals/activites in the simulation model and check the results.</p>
<p>The most simple way to modify the model for these tests is to set parameters to <span class="math notranslate nohighlight">\(M\)</span> a very large number.</p>
<p>We test</p>
<ul class="simple">
<li><p>Block all arrivals</p></li>
<li><p>Acute LoS is infinite</p></li>
<li><p>Block all but stroke-&gt;rehab patient arrivals in the ASU.</p></li>
<li><p>Block all rehab arrivals apart from stroke.</p></li>
<li><p>Block all external rehab arrivals</p></li>
<li><p>Rehab LoS is infinite (Rehab model only)</p></li>
<li><p>Block all arrivals to the ASU and Rehab models</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mi">10_000_000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ev_test_2</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have their inter-arrival time set to $M$ a very large number.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients arrive to the model.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    int: the number of patients that arrived to the model.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>
    
    <span class="c1"># Define custom parameters</span>
    <span class="n">custom_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;patient_types&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;Stroke&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">},</span>
            <span class="s1">&#39;TIA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">},</span>
            <span class="s1">&#39;Complex Neurological&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">},</span>
            <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1"># Create an Experiment instance with custom parameters</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">custom_params</span><span class="p">)</span>
    
    <span class="c1"># Run the simulation with the custom experiment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>
    
    <span class="c1"># Print results to check</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Simulation completed.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total simulation time: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total patient arrivals: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">patient_types</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">patient_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> arrivals: </span><span class="si">{</span><span class="n">patient_type</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Return the number of total arrivals</span>

    <span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">total_arrivals</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ev_test_3</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have have their mean length </span>
<span class="sd">    of stay time set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients depart the model </span>
<span class="sd">    The number of arrivals = the occupancy of the model.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>
    
    <span class="c1"># Define custom parameters</span>
    <span class="n">custom_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Stroke&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Rehab&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">),</span> <span class="s1">&#39;ESD&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">),</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">)},</span>
        <span class="s1">&#39;TIA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
        <span class="s1">&#39;Complex Neurological&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
        <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1"># Create an Experiment instance with custom parameters</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">custom_params</span><span class="p">)</span>
    
    <span class="c1"># Run the simulation with the custom experiment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>
    
    <span class="c1"># Print results to check</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Simulation completed.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total simulation time: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total patient arrivals: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">patient_types</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">patient_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> arrivals: </span><span class="si">{</span><span class="n">patient_type</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Return the number of total arrivals</span>

    <span class="n">total_arrivals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">total_arrivals</span>
    <span class="n">final_occupancy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occupancy</span>

    <span class="k">return</span> <span class="n">total_arrivals</span> <span class="o">==</span> <span class="n">final_occupancy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_4</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types apart from stroke-rehab patients</span>
<span class="sd">    have have their mean length </span>
<span class="sd">    of stay time set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: Only stroke patients depart the</span>
<span class="sd">    model.</span>
<span class="sd">    (assessed crudely with patient_count &gt; occupancy),</span>
<span class="sd">    and also from log - see manual testing notebook.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Define custom parameters</span>
    <span class="n">custom_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Stroke&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Rehab&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.4</span><span class="p">,</span> <span class="mf">8.6</span><span class="p">),</span> <span class="s1">&#39;ESD&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">),</span> <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">)},</span>
        <span class="s1">&#39;TIA&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
        <span class="s1">&#39;Complex Neurological&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
        <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">large_number</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1"># Create an Experiment instance with custom parameters</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">custom_params</span><span class="p">)</span>
    
    <span class="c1"># Run the simulation with the custom experiment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>
    
    <span class="c1"># Print results to check</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Simulation completed.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total simulation time: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total patient arrivals: </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">patient_types</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">patient_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> arrivals: </span><span class="si">{</span><span class="n">patient_type</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Return the number of total arrivals</span>

    <span class="n">total_arrivals</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">total_arrivals</span>
    <span class="n">final_occupancy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">occupancy</span>

    <span class="k">assert</span> <span class="n">total_arrivals</span> <span class="o">&gt;</span> <span class="n">final_occupancy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_5</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Complex Neuro, Other, have their rehab inter-arrival </span>
<span class="sd">    time is set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: The only type of patient to arrive to the rehab model </span>
<span class="sd">    is &quot;Stroke&quot;. This is verified by the patient counts variables in the model.</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    This test will need to be modified when the hardcoded parameters</span>
<span class="sd">    are migrated to the Experiment class. </span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool: rehab_unit.stroke_count == rehab_unit.patient_count</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>
    
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">({</span>
        <span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Set to True if you want to see detailed logs</span>
        <span class="s1">&#39;rehab_stroke_iat&#39;</span><span class="p">:</span> <span class="mf">21.8</span><span class="p">,</span>
        <span class="s1">&#39;rehab_neuro_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_other_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span>
    <span class="p">})</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="c1"># Print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Patient counts:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">patient_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total arrivals: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check if only Stroke patients arrived</span>
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_counts</span><span class="p">[</span><span class="s1">&#39;Stroke&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_6</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have their REHAB inter-arrival </span>
<span class="sd">    time is set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients arrive to the model</span>
<span class="sd">    This is verified by the patient count variables in the model.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool:rehab_unit.patient_count == 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">({</span>
        <span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set to True if you want to see detailed logs</span>
        <span class="s1">&#39;rehab_stroke_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_neuro_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_other_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span>
    <span class="p">})</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="c1"># Print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Patient counts:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">patient_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total arrivals: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total arrivals: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_7</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have have their mean length </span>
<span class="sd">    of stay time in REHAB set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients depart the rehab model </span>
<span class="sd">    The occupancy of the model is equal to the no. patient arrivals</span>
<span class="sd">    </span>
<span class="sd">    Notes:</span>
<span class="sd">    -----</span>
<span class="sd">    This test will also need to be modified when TIA treatment is added</span>
<span class="sd">    and tested when working in connection with the ASU.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">({</span>
        <span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set to True if you want to see detailed logs</span>
        <span class="s1">&#39;rehab_stroke_esd_los_mean&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_stroke_other_los_mean&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_complex_neuro_los_mean&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_other_los_mean&#39;</span><span class="p">:</span> <span class="n">large_number</span>
    <span class="p">})</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;results_collection_period&#39;</span><span class="p">])</span>

    <span class="c1"># Print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Patient counts:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">patient_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total arrivals: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total arrivals: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span> <span class="o">==</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">occupancy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_8</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have their AUS and REHAB inter-arrival </span>
<span class="sd">    time is set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients arrive to the model</span>
<span class="sd">    This is verified by the patient count variables in the model.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool:rehab_unit.patient_count == 0 and asu.patient_count == 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Set all inter-arrival times to a large number</span>
    <span class="n">experiment_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;run_length&#39;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span>  <span class="c1"># Run for 1 year</span>
        <span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;patient_types&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;Stroke&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">},</span>
            <span class="s1">&#39;TIA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">},</span>
            <span class="s1">&#39;Complex Neurological&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">},</span>
            <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;interarrival_time&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">}</span>
        <span class="p">},</span>
        <span class="s1">&#39;rehab_stroke_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_neuro_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="s1">&#39;rehab_other_iat&#39;</span><span class="p">:</span> <span class="n">large_number</span>
    <span class="p">}</span>
    
    <span class="c1"># Create experiment</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">experiment_params</span><span class="p">)</span>
    
    <span class="c1"># Create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
    <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">asu</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">rehab_unit</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="c1"># Run the simulation</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;run_length&#39;</span><span class="p">])</span>

    <span class="c1"># Print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ASU total arrivals: </span><span class="si">{</span><span class="n">asu</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rehab total arrivals: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">patient_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">asu</span><span class="o">.</span><span class="n">patient_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ASU </span><span class="si">{</span><span class="n">patient_type</span><span class="si">}</span><span class="s1"> count: </span><span class="si">{</span><span class="n">count</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rehab patient counts: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_counts</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ASU occupancy: </span><span class="si">{</span><span class="n">asu</span><span class="o">.</span><span class="n">occupancy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rehab occupancy: </span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">occupancy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># Check if all patient counts are zero</span>
    <span class="n">asu_zero</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">asu</span><span class="o">.</span><span class="n">patient_types</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">rehab_zero</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_counts</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    
    <span class="k">assert</span> <span class="n">asu</span><span class="o">.</span><span class="n">total_arrivals</span> <span class="o">==</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">total_arrivals</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-tracing-functionality">
<h3>Test tracing functionality<a class="headerlink" href="#test-tracing-functionality" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_trace</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify trace messages are printed when trace=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">multiple_replications</span>

    <span class="c1"># Run the model once</span>
    <span class="n">default_experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">({</span><span class="s1">&#39;trace&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
    <span class="n">rep_results</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">default_experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Capture printed output</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
    
    <span class="c1"># Check for some of the expected messages based on actual code</span>
    <span class="k">assert</span> <span class="s2">&quot;Total arrivals&quot;</span> <span class="ow">in</span> <span class="n">captured</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-plotting-functions">
<h3>Test plotting functions<a class="headerlink" href="#test-plotting-functions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_occupancy_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the output of occupancy_plot() is as expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">occupancy_plot</span>

    <span class="c1"># Create a plot with simple data</span>
    <span class="n">relative_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">occupancy_plot</span><span class="p">(</span><span class="n">relative_frequency</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)</span>

    <span class="c1"># Check characteristics</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>  <span class="c1"># Should have 3 bars</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.5</span>  <span class="c1"># Check bar height</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;No. people in ward&quot;</span>  <span class="c1"># Default label</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Relative Frequency&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>

    <span class="c1"># Close the figure to prevent display</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_prob_delay_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the output of prob_delay_plot() is as expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">prob_delay_plot</span>

    <span class="c1"># Create a plot with simple data</span>
    <span class="n">prob_delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">prob_delay_plot</span><span class="p">(</span><span class="n">prob_delay</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)</span>
    
    <span class="c1"># Check characteristics</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Should have one step line</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;No. acute beds available&quot;</span>  <span class="c1"># Default label</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Probability of Delay&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>

    <span class="c1"># Close the figure to prevent display</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-streamlit-app">
<h3>Test streamlit app<a class="headerlink" href="#test-streamlit-app" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_streamlit_app_loads</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify that the streamlit app loads without errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run the app</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">AppTest</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;s2_stroke_rehab_interface.py&quot;</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="c1"># Expected title</span>
    <span class="n">exp_title</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A Modelling Tool for Capacity Planning in Acute and &quot;</span> <span class="o">+</span>
                 <span class="s2">&quot;Community Stroke Services&quot;</span><span class="p">)</span>

    <span class="c1"># Check that main elements are present</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">at</span><span class="o">.</span><span class="n">exception</span>
    <span class="k">assert</span> <span class="n">exp_title</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">slider</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="c1"># Patients</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">number_input</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># Warm-up and replications</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">checkbox</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Trace checkbox</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">button</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Simulate button</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_streamlit_simulate_button</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that clicking the simulate button runs the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run the app</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">AppTest</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;s2_stroke_rehab_interface.py&quot;</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Run for 2 replications (else test times out)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">number_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Click simulate button</span>
    <span class="n">at</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Check that no exception occurred</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">at</span><span class="o">.</span><span class="n">exception</span>

    <span class="c1"># Get dataframes</span>
    <span class="n">acu_df</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">rehab_df</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    
    <span class="c1"># Expected values</span>
    <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Probability of delay&#39;</span><span class="p">,</span> <span class="s1">&#39;% patients delayed&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;1 in every n patients delayed&#39;</span><span class="p">]</span>
    <span class="n">expected_acu_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
    <span class="n">expected_rehab_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
    
    <span class="c1"># Check columns (same for both dataframes)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">acu_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_columns</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rehab_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_columns</span>
    
    <span class="c1"># Check index values</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">acu_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_acu_index</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rehab_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_rehab_index</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-the-patienttype-methods">
<h3>Test the <code class="docutils literal notranslate"><span class="pre">PatientType</span></code> methods<a class="headerlink" href="#test-the-patienttype-methods" title="Link to this heading">#</a></h3>
<p>This is stage 2 specific.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_sample_post_asu_destination</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that sample_post_asu_destination raises ValueError when rng is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">PatientType</span>

    <span class="c1"># Creates a PatientType instance (rng defaults to None)</span>
    <span class="n">patient_type</span> <span class="o">=</span> <span class="n">PatientType</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span>
        <span class="n">interarrival_time</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
        <span class="n">post_asu_probabilities</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">los_params</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">)</span>
    
    <span class="c1"># This should raise ValueError because rng is None</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;RNG not set for PatientType&quot;</span><span class="p">):</span>
        <span class="n">patient_type</span><span class="o">.</span><span class="n">sample_post_asu_destination</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-summary-table">
<h3>Test <code class="docutils literal notranslate"><span class="pre">summary_table</span></code><a class="headerlink" href="#test-summary-table" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_zero_probability_gives_na</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that pdelay=0 goes to else branch and uses N/A</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">summary_table</span>

    <span class="n">prob_delay</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">(</span><span class="n">prob_delay</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;1 in every n patients delayed&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_beds_beyond_array_gives_na</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that beds &gt;= len(prob_delay) goes to else branch and uses N/A</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">s2_stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">summary_table</span>

    <span class="c1"># Only index 0 exists</span>
    <span class="n">prob_delay</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span>
    <span class="c1"># Ask for bed=1 which doesn&#39;t exist</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">summary_table</span><span class="p">(</span><span class="n">prob_delay</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Probability of delay&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;% patients delayed&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1 in every n patients delayed&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;N/A&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="run-all-automated-tests">
<h2>Run all automated tests<a class="headerlink" href="#run-all-automated-tests" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ipytest</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="s2">&quot;-vv&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-header&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--cov=s2_stroke_rehab_model&quot;</span><span class="p">,</span> <span class="s2">&quot;--cov=s2_stroke_rehab_interface&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--cov-report=term&quot;</span><span class="p">,</span> <span class="s2">&quot;--cov-report=annotate&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">======================================= test session starts ========================================</span>
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>collected 33 items

t_4725ba0fd6594fd29f9e21da56f64136.py::test_result_processing_1[values0-rel_expected0-cum_expected0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED [  3%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_result_processing_2[relative0-cum0-p_delay_expected0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED [  6%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_results_collection_2 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                      [  9%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_results_collection_system 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                 [ 12%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_warm_up[365-1] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                            [ 15%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_warm_up[1000-1] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                           [ 18%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_single_run 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                [ 21%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_1[0-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 24%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_1[1-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 27%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_1[2-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 30%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_1[101-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED            [ 33%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_1[42-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED             [ 36%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_2[0-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 39%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_2[1-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 42%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_2[2-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 45%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_2[101-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED            [ 48%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_random_number_set_2[42-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED             [ 51%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_lognormal_moments[128.79-267.51] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED          [ 54%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_lognormal_moments[50.0-2.0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED               [ 57%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_lognormal_moments[10.5-1.0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED               [ 60%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_ev_4 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 63%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_ev_5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 66%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_ev_6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 69%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_ev_7 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 72%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_ev_8 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 75%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_trace 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                     [ 78%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_occupancy_plot 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                            [ 81%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_prob_delay_plot 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                           [ 84%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_streamlit_app_loads 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                       [ 87%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_streamlit_simulate_button 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 90%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_sample_post_asu_destination 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">               [ 93%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_zero_probability_gives_na 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [ 96%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_4725ba0fd6594fd29f9e21da56f64136.py::test_beds_beyond_array_gives_na 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                [100%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">========================================= warnings summary =========================================</span>
t_4725ba0fd6594fd29f9e21da56f64136.py::test_occupancy_plot
t_4725ba0fd6594fd29f9e21da56f64136.py::test_occupancy_plot
t_4725ba0fd6594fd29f9e21da56f64136.py::test_occupancy_plot
  /home/tom/miniforge3/envs/gen_simpy/lib/python3.10/site-packages/IPython/core/pylabtools.py:77: DeprecationWarning: backend2gui is deprecated since IPython 8.24, backends are managed in matplotlib and can be externally registered.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
========================================== tests coverage ==========================================
_________________________ coverage: platform linux, python 3.10.13-final-0 _________________________

Name                           Stmts   Miss  Cover
--------------------------------------------------
s2_stroke_rehab_interface.py      48      0   100%
s2_stroke_rehab_model.py         396      0   100%
--------------------------------------------------
TOTAL                            444      0   100%
Coverage annotated source written next to source
<span class=" -Color -Color-Yellow">================================== </span><span class=" -Color -Color-Green">33 passed</span>, <span class=" -Color -Color-Bold -Color-Bold-Yellow">3 warnings</span><span class=" -Color -Color-Yellow"> in 5.48s ==================================</span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ExitCode.OK: 0&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-coverage-report">
<h2>Test coverage report<a class="headerlink" href="#test-coverage-report" title="Link to this heading">#</a></h2>
<p>The percentage coverage is reported in the cell above. Below is the annotated report for the model. Grey lines (” “) are excluded, green lines (“&gt;”) are covered, and red lines (“!”) are not covered.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_coverage</span><span class="p">(</span><span class="s1">&#39;s2_stroke_rehab_model.py,cover&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; &quot;&quot;&quot;A SimPy-based simulation model for analyzing patient flow in stroke care units.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; INTERNAL REPRODUCTION RUN - STAGE 2</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; This module simulates the patient flow through an Acute Stroke Unit (ASU) and a connected</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Rehabilitation Unit to assist in capacity planning for acute and community stroke services.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; It models patient arrivals, treatment durations, and transitions between units using</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; statistical distributions to provide insights into occupancy levels and potential delays.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Authors: LLM implemented by Perplexity.AI</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Auto-formatted with `black` for PEP8 compliance.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Based on:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; ---------</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Monks et al. A modelling tool for capacity planning in acute</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; and community stroke services</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; https://link.springer.com/article/10.1186/s12913-016-1789-4</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; All functions and classes included in this module have been</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; generated between Jun-Jul 2024 by the LLM implemented by Perplexity.AI</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; https://www.perplexity.ai/</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Auto-formatting:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; ----------------</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; After generation was complete We used `black` to autoformat the code</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; to PEP8 standards</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Prompts used:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; -----------</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; The prompts were taken from stage 1 model creation. Additional prompts</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; were used when needed i.e. if the original prompt did not provide the</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; desired output in stage 2.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import math</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import statistics</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import simpy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import numpy as np</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import pandas as pd</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import matplotlib.pyplot as plt</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # lognormal function</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def lognormal_to_normal(mean, std):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Convert lognormal moments to normal moments.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     mean (float): Mean of the lognormal distribution.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     std (float): Standard deviation of the lognormal distribution.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Returns:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     tuple: (mean, std) of the corresponding normal distribution.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     normal_mean = np.log(mean**2 / np.sqrt(std**2 + mean**2))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     normal_std = np.sqrt(np.log(std**2 / mean**2 + 1))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return normal_mean, normal_std</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Experiment class</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class Experiment:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(self, params=None, random_number_set=0):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         default_params = {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;results_collection_period&quot;: 5 * 365,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;warm_up&quot;: 1095,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;trace&quot;: False,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;acute_audit_interval&quot;: 1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_audit_interval&quot;: 1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_stroke_iat&quot;: 21.8,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_neuro_iat&quot;: 31.7,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_other_iat&quot;: 28.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_stroke_esd_los_mean&quot;: 30.3,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_stroke_esd_los_std&quot;: 23.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_stroke_other_los_mean&quot;: 28.4,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_stroke_other_los_std&quot;: 27.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_complex_neuro_los_mean&quot;: 27.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_complex_neuro_los_std&quot;: 28.4,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_other_los_mean&quot;: 16.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_other_los_std&quot;: 14.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_stroke_post_destination_probs&quot;: [0.4, 0.6],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_complex_neuro_post_destination_probs&quot;: [0.09, 0.91],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;rehab_other_post_destination_probs&quot;: [0.12, 0.88],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;patient_types&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;Stroke&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;interarrival_time&quot;: 1.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;post_asu_probabilities&quot;: [0.24, 0.13, 0.63],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;los_params&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;Rehab&quot;: (7.4, 8.6),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;ESD&quot;: (4.6, 4.8),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;Other&quot;: (7.0, 8.7),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;TIA&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;interarrival_time&quot;: 9.3,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;post_asu_probabilities&quot;: [0.01, 0.01, 0.98],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;los_params&quot;: (1.8, 5.0),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;Complex Neurological&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;interarrival_time&quot;: 3.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;post_asu_probabilities&quot;: [0.11, 0.05, 0.84],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;los_params&quot;: (4.0, 5.0),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;Other&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;interarrival_time&quot;: 3.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;post_asu_probabilities&quot;: [0.05, 0.10, 0.85],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;los_params&quot;: (3.8, 5.2),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         }</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if params is None:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.params = default_params</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.params = self.merge_params(default_params, params)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.asu_occupancy = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_occupancy = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.warm_up = self.params[&quot;warm_up&quot;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.setup_streams(random_number_set)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def merge_params(self, default, new):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         merged = default.copy()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for key, value in new.items():</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if isinstance(value, dict) and key in merged:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 merged[key] = self.merge_params(merged[key], value)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 merged[key] = value</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         return merged</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def audit_acute_occupancy(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, env, first_interval, audit_interval, asu, experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield env.timeout(first_interval)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.asu_occupancy.append(asu.occupancy)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield env.timeout(audit_interval)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def audit_rehab_occupancy(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, env, first_interval, audit_interval, rehab_unit, experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield env.timeout(first_interval)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.rehab_occupancy.append(rehab_unit.occupancy)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield env.timeout(audit_interval)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def reset_kpi(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.asu_occupancy = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_occupancy = []</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def setup_streams(self, random_number_set):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.streams = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         generator = np.random.default_rng(random_number_set)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         seeds = generator.integers(0, np.iinfo(np.int64).max, size=25)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for seed in seeds:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.streams.append(np.random.default_rng(seed))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # ### ASU Patient type class</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class PatientType:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(self, name, interarrival_time, post_asu_probabilities, los_params):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.name = name</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.interarrival_time = interarrival_time</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.count = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rng = None  # This will be set in the patient_generator method</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.post_asu_probabilities = post_asu_probabilities</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.los_params = los_params</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def sample_post_asu_destination(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.rng is None:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             raise ValueError(&quot;RNG not set for PatientType&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         return self.rng.choice([&quot;Rehab&quot;, &quot;ESD&quot;, &quot;Other&quot;], p=self.post_asu_probabilities)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def normal_moments(self, destination=None):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.name == &quot;Stroke&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean, std = self.los_params[destination]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean, std = self.los_params</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         normal_mean = math.log(mean**2 / math.sqrt(std**2 + mean**2))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         normal_std = math.sqrt(math.log(1 + (std**2 / mean**2)))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         return normal_mean, normal_std</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Acute stroke unit class</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class AcuteStrokeUnit:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(self, env, experiment, rehab_unit):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env = env</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.experiment = experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_unit = rehab_unit</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.total_arrivals = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.trace = experiment.params[&quot;trace&quot;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.patient_types = {}</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for name, params in experiment.params[&quot;patient_types&quot;].items():</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_types[name] = PatientType(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 name,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 params[&quot;interarrival_time&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 params[&quot;post_asu_probabilities&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 params[&quot;los_params&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def run(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for patient_type in self.patient_types.values():</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.patient_generator(patient_type))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def patient_generator(self, patient_type):</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Assign specific streams for each patient type</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if patient_type.name == &quot;Stroke&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             arrival_stream = self.experiment.streams[6]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_stream = self.experiment.streams[7]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif patient_type.name == &quot;TIA&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             arrival_stream = self.experiment.streams[8]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_stream = self.experiment.streams[9]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif patient_type.name == &quot;Complex Neurological&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             arrival_stream = self.experiment.streams[10]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_stream = self.experiment.streams[11]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:  # Other</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             arrival_stream = self.experiment.streams[12]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_stream = self.experiment.streams[13]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Replace the RNG in the PatientType instance</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         patient_type.rng = post_asu_stream</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = arrival_stream.exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 patient_type.interarrival_time</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.total_arrivals += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             patient_type.count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             patient_id = self.total_arrivals - 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_destination = patient_type.sample_post_asu_destination()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Assign different seeds based on post-ASU destination for stroke patients</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if patient_type.name == &quot;Stroke&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     los_stream = self.experiment.streams[0]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 elif post_asu_destination == &quot;ESD&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     los_stream = self.experiment.streams[1]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 else:  # Other</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     los_stream = self.experiment.streams[2]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 los_stream = None  # Placeholder for non-stroke patients</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Time {self.env.now:.2f}: Patient {patient_id} ({patient_type.name}) arrived&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(f&quot; Total arrivals: {self.total_arrivals}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(f&quot; {patient_type.name} arrivals: {patient_type.count}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(f&quot; Post-ASU destination: {post_asu_destination}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot; Next {patient_type.name} arrival in {interarrival_time:.2f} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(f&quot; Current occupancy: {self.occupancy}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if patient_type.name == &quot;Stroke&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.stroke_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif patient_type.name == &quot;TIA&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.tia_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif patient_type.name == &quot;Complex Neurological&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.complex_neurological_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:  # Other</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.other_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} ({patient_type.name}) left ASU&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Current occupancy: {self.occupancy}&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         normal_mean, normal_std = self.patient_types[&quot;Stroke&quot;].normal_moments(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_destination</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         los = los_stream.lognormal(mean=normal_mean, sigma=normal_std)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Stroke) starting acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {los:.2f} days&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(los)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Stroke) finished acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.arrivals_from_asu += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.rehab_unit.rehab_treatment(patient_type.name, patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot; Post-ASU destination (stroke to stroke rehab): {post_asu_destination, patient_id}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def tia_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         normal_mean, normal_std = patient_type.normal_moments()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         los = self.experiment.streams[3].lognormal(mean=normal_mean, sigma=normal_std)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (TIA) starting acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {los:.2f} days&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(los)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (TIA) finished acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.arrivals_from_asu += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.rehab_unit.rehab_treatment(patient_type.name, patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot; Post-ASU destination (tia to tia rehab): {post_asu_destination, patient_id}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def complex_neurological_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         normal_mean, normal_std = patient_type.normal_moments()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         los = self.experiment.streams[4].lognormal(mean=normal_mean, sigma=normal_std)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Complex Neurological) starting acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {los:.2f} days&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(los)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Complex Neurological) finished acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.arrivals_from_asu += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.rehab_unit.rehab_treatment(patient_type.name, patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot; Post-ASU destination (complex to complex rehab): {post_asu_destination, patient_id}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_acute_treatment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self, patient_type, patient_id, post_asu_destination, los_stream</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         normal_mean, normal_std = patient_type.normal_moments()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         los = self.experiment.streams[5].lognormal(mean=normal_mean, sigma=normal_std)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Other) starting acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {los:.2f} days&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(los)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Other) finished acute treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.arrivals_from_asu += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.rehab_unit.rehab_treatment(patient_type.name, patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot; Post-ASU destination (other to other rehab): {post_asu_destination, patient_id}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Rehabilitation Unit class</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class RehabilitationUnit:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(self, env, experiment):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env = env</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.experiment = experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.trace = experiment.params[&quot;trace&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.total_arrivals = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.arrivals_from_asu = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.patient_counts = {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;Stroke&quot;: 0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;Complex Neurological&quot;: 0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;Other&quot;: 0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;TIA&quot;: 0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         }</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.stroke_iat_external = experiment.params[&quot;rehab_stroke_iat&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.complex_neuro_iat_external = experiment.params[&quot;rehab_neuro_iat&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_iat_external = experiment.params[&quot;rehab_other_iat&quot;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Convert lognormal moments to normal moments</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.stroke_esd_mean, self.stroke_esd_std = lognormal_to_normal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_stroke_esd_los_mean&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_stroke_esd_los_std&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.stroke_other_mean, self.stroke_other_std = lognormal_to_normal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_stroke_other_los_mean&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_stroke_other_los_std&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.complex_neuro_mean, self.complex_neuro_std = lognormal_to_normal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_complex_neuro_los_mean&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_complex_neuro_los_std&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_mean, self.other_std = lognormal_to_normal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_other_los_mean&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_other_los_std&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.tia_mean, self.tia_std = lognormal_to_normal(18.7, 23.5)  # TIA parameters</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def run(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env.process(self.stroke_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env.process(self.complex_neuro_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env.process(self.other_generator())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[14]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(stream.exponential(self.stroke_iat_external))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_arrival(&quot;Stroke&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def complex_neuro_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[15]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(stream.exponential(self.complex_neuro_iat_external))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_arrival(&quot;Complex Neurological&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[16]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(stream.exponential(self.other_iat_external))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_arrival(&quot;Other&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def patient_arrival(self, patient_type):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         patient_id = self.total_arrivals</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.total_arrivals += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.patient_counts[patient_type] += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy += 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.params[&quot;trace&quot;]:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} ({patient_type}) arrived at RU&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Total arrivals: {self.total_arrivals}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; {patient_type} arrivals: {self.patient_counts[patient_type]}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Current patient counts: {self.patient_counts}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Current occupancy: {self.occupancy}&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env.process(self.rehab_treatment(patient_type, patient_id))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def rehab_treatment(self, patient_type, patient_id):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if patient_type == &quot;Stroke&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.stroke_rehab_treatment(patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif patient_type == &quot;Complex Neurological&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.complex_neurological_rehab_treatment(patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif patient_type == &quot;TIA&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.tia_rehab_treatment(patient_id)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield from self.other_rehab_treatment(patient_id)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.params[&quot;trace&quot;]:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} ({patient_type}) left RU&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Current occupancy: {self.occupancy}&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_rehab_treatment(self, patient_id):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[20]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[19].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             p=self.experiment.params[&quot;rehab_stroke_post_destination_probs&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_rehab_destination == &quot;ESD&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             length_of_stay = stream.lognormal(self.stroke_esd_mean, self.stroke_esd_std)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             length_of_stay = stream.lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.stroke_other_mean, self.stroke_other_std</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.params[&quot;trace&quot;]:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Stroke) completed rehab treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Post-rehab destination: {post_rehab_destination}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {length_of_stay:.2f} days&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def complex_neurological_rehab_treatment(self, patient_id):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[22]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[21].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             p=self.experiment.params[&quot;rehab_complex_neuro_post_destination_probs&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = stream.lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.complex_neuro_mean, self.complex_neuro_std</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.params[&quot;trace&quot;]:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Complex Neurological) completed rehab treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Post-rehab destination: {post_rehab_destination}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {length_of_stay:.2f} days&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_rehab_treatment(self, patient_id):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[24]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[23].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             p=self.experiment.params[&quot;rehab_other_post_destination_probs&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = stream.lognormal(self.other_mean, self.other_std)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.params[&quot;trace&quot;]:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (Other) completed rehab treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Post-rehab destination: {post_rehab_destination}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {length_of_stay:.2f} days&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def tia_rehab_treatment(self, patient_id):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stream = self.experiment.streams[18]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[17].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;], p=[0, 1]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )  # Always &#x27;Other&#x27; for TIA patients</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = stream.lognormal(self.tia_mean, self.tia_std)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.params[&quot;trace&quot;]:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Time {self.env.now:.2f}: Patient {patient_id} (TIA) completed rehab treatment&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Post-rehab destination: {post_rehab_destination}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(f&quot; Length of stay: {length_of_stay:.2f} days&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Occupancy post-processing code</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def calculate_occupancy_frequencies(occupancy_list):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     unique_values, counts = np.unique(occupancy_list, return_counts=True)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     relative_freq = counts / len(occupancy_list)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     cumulative_freq = np.cumsum(relative_freq)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return relative_freq, cumulative_freq, unique_values</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def occupancy_plot(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     relative_freq, unique_values, x_label=&quot;No. people in ward&quot;, figsize=(12, 5)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     fig, ax = plt.subplots(figsize=figsize)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.bar(unique_values, relative_freq)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xlabel(x_label)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_ylabel(&quot;Relative Frequency&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_title(&quot;Occupancy Distribution&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Set x-axis ticks and limits based on the data</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_value = max(unique_values)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xticks(range(0, max_value + 1, max(1, max_value // 10)))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xlim(0, max_value)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return fig, ax</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Probability of deplay post-processing code</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def calculate_prob_delay(relative_freq, cumulative_freq):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rel_freq = np.array(relative_freq)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     cum_freq = np.array(cumulative_freq)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return rel_freq / cum_freq</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def prob_delay_plot(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay, unique_values, x_label=&quot;No. acute beds available&quot;, figsize=(12, 5)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     fig, ax = plt.subplots(figsize=figsize)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.step(unique_values, prob_delay, where=&quot;post&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xlabel(x_label)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_ylabel(&quot;Probability of Delay&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_title(&quot;Probability of Delay vs. Number of Beds Available&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Set x-axis ticks and limits based on the data</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_value = max(unique_values)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xticks(range(0, max_value + 1, max(1, max_value // 10)))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xlim(0, max_value)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_ylim(0, 1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return fig, ax</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Function to perform a single run of ASU+REHAB</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def single_run(experiment):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     experiment.reset_kpi()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Create the simulation environment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env = simpy.Environment()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Create models</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rehab_unit = RehabilitationUnit(env, experiment)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     asu = AcuteStrokeUnit(env, experiment, rehab_unit)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Run models</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rehab_unit.run()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     asu.run()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Start the audit processes</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment.audit_acute_occupancy(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             env,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.warm_up,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;acute_audit_interval&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment.audit_rehab_occupancy(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             env,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.warm_up,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment.params[&quot;rehab_audit_interval&quot;],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             rehab_unit,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Run the simulation</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.run(until=experiment.warm_up + experiment.params[&quot;results_collection_period&quot;])</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Calculate occupancy frequencies and probabilities of delay</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rel_freq_a, cum_freq_a, unique_vals_a = calculate_occupancy_frequencies(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment.asu_occupancy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay_a = calculate_prob_delay(rel_freq_a, cum_freq_a)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rel_freq_r, cum_freq_r, unique_vals_r = calculate_occupancy_frequencies(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment.rehab_occupancy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay_r = calculate_prob_delay(rel_freq_r, cum_freq_r)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;relative_freq_asu&quot;: rel_freq_a,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;prob_delay_asu&quot;: prob_delay_a,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;unique_vals_asu&quot;: unique_vals_a,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;relative_freq_rehab&quot;: rel_freq_r,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;prob_delay_rehab&quot;: prob_delay_r,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;unique_vals_rehab&quot;: unique_vals_r,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     }</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Multiple Replication function</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def multiple_replications(experiment_instance, num_replications=5):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rep_results = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for rep in range(num_replications):</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Call setup_streams with the current replication number</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment_instance.setup_streams(rep)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Run the simulation for this replication</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rep_result = single_run(experiment_instance)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Append the results of this replication</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rep_results.append(rep_result)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return rep_results</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Functions to combine replication results</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def combine_pdelay_results(rep_results):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     asu_results = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rehab_results = []</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Determine the maximum occupancy value across all results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_occupancy = max(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         max(max(result[&quot;unique_vals_asu&quot;]), max(result[&quot;unique_vals_rehab&quot;]))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for result in rep_results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Use max_occupancy + 1 to ensure we include the maximum value</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     array_size = max_occupancy + 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for result in rep_results:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         prob_delay_asu = result[&quot;prob_delay_asu&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_asu = result[&quot;unique_vals_asu&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         min_occupancy_asu = min(unique_vals_asu)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_array = np.zeros(array_size)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_array[unique_vals_asu] = prob_delay_asu</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_array[:min_occupancy_asu] = 1.0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_results.append(asu_array)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         prob_delay_rehab = result[&quot;prob_delay_rehab&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_rehab = result[&quot;unique_vals_rehab&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         min_occupancy_rehab = min(unique_vals_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_array = np.zeros(array_size)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_array[unique_vals_rehab] = prob_delay_rehab</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_array[:min_occupancy_rehab] = 1.0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_results.append(rehab_array)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return np.array(asu_results), np.array(rehab_results)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def combine_occup_results(rep_results):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     asu_results = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rehab_results = []</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Determine the maximum occupancy value across all results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_occupancy = max(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         max(max(result[&quot;unique_vals_asu&quot;]), max(result[&quot;unique_vals_rehab&quot;]))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for result in rep_results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Use max_occupancy + 1 to ensure we include the maximum value</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     array_size = max_occupancy + 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for result in rep_results:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         relative_freq_asu = result[&quot;relative_freq_asu&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_asu = result[&quot;unique_vals_asu&quot;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_array = np.zeros(array_size)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_array[unique_vals_asu] = relative_freq_asu</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         asu_results.append(asu_array)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         relative_freq_rehab = result[&quot;relative_freq_rehab&quot;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_rehab = result[&quot;unique_vals_rehab&quot;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_array = np.zeros(array_size)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_array[unique_vals_rehab] = relative_freq_rehab</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_results.append(rehab_array)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return np.array(asu_results), np.array(rehab_results)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def mean_results(rep_results):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return np.mean(rep_results, axis=0)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # Tabular results for p(delay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def summary_table(prob_delay, min_beds, max_beds, bed_type=&quot;ASU&quot;):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     data = {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         f&quot;No. {bed_type} beds&quot;: [],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;Probability of delay&quot;: [],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;% patients delayed&quot;: [],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;1 in every n patients delayed&quot;: [],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     }</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for beds in range(min_beds, max_beds + 1):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if beds &lt; len(prob_delay):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             pdelay = prob_delay[beds]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[f&quot;No. {bed_type} beds&quot;].append(beds)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[&quot;Probability of delay&quot;].append(f&quot;{pdelay:.2f}&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[&quot;% patients delayed&quot;].append(f&quot;{pdelay * 100:.1f}%&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if pdelay &gt; 0:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 data[&quot;1 in every n patients delayed&quot;].append(int(np.floor(1 / pdelay)))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 data[&quot;1 in every n patients delayed&quot;].append(&quot;N/A&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # If we&#x27;ve run out of data, fill with N/A</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[f&quot;No. {bed_type} beds&quot;].append(beds)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[&quot;Probability of delay&quot;].append(&quot;N/A&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[&quot;% patients delayed&quot;].append(&quot;N/A&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             data[&quot;1 in every n patients delayed&quot;].append(&quot;N/A&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     df = pd.DataFrame(data)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     df.set_index(f&quot;No. {bed_type} beds&quot;, inplace=True)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return df</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_coverage</span><span class="p">(</span><span class="s1">&#39;s2_stroke_rehab_interface.py,cover&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import streamlit as st</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import numpy as np</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; from s2_stroke_rehab_model import (</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Experiment,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     multiple_replications,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     combine_pdelay_results,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     combine_occup_results,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     mean_results,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay_plot,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     occupancy_plot,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     summary_table,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def main():</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.title(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;A Modelling Tool for Capacity Planning in Acute and Community Stroke Services&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     This model is a recreation of the model reported in a published academic study.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     **Citation:**</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Monks T, Worthington D, Allen M, Pitt M, Stein K, James MA. A modelling tool for capacity planning in acute and community stroke services. BMC Health Serv Res. 2016 Sep 29;16(1):530. doi: 10.1186/s12913-016-1789-4. PMID: 27688152; PMCID: PMC5043535.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(&quot;[Link to the original study](https://doi.org/10.1186/s12913-016-1789-4)&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Sidebar for input parameters</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.sidebar.header(&quot;Set Patient Inter-arrival Rates&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     stroke_mean = st.sidebar.slider(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;Stroke patients&quot;, min_value=0.0, max_value=10.0, value=1.2, step=0.1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     tia_mean = st.sidebar.slider(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;TIA patients&quot;, min_value=0.0, max_value=10.0, value=9.3, step=0.1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     neuro_mean = st.sidebar.slider(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;Complex Neurological patients&quot;,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         min_value=0.0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         max_value=10.0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         value=3.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         step=0.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     other_mean = st.sidebar.slider(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;Other patients&quot;, min_value=0.0, max_value=10.0, value=3.2, step=0.1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.sidebar.header(&quot;Model Control&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     trace = st.sidebar.checkbox(&quot;Trace patients in simulation&quot;, value=False)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     warm_up = st.sidebar.number_input(&quot;Warm-up period (days)&quot;, value=1095, step=1)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     num_replications = st.number_input(&quot;Number of Replications&quot;, value=100, min_value=1)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     if st.button(&quot;Simulate&quot;):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         with st.spinner(&quot;Please wait for results...&quot;):</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Create the experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment_params = {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;results_collection_period&quot;: 365 * 5,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;trace&quot;: trace,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;warm_up&quot;: warm_up,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 &quot;patient_types&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;Stroke&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;interarrival_time&quot;: stroke_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;los_params&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                             &quot;Rehab&quot;: (7.4, 8.6),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                             &quot;ESD&quot;: (4.6, 4.8),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                             &quot;Other&quot;: (7.0, 8.7),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;TIA&quot;: {&quot;interarrival_time&quot;: tia_mean, &quot;los_params&quot;: (1.8, 5.0)},</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;Complex Neurological&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;interarrival_time&quot;: neuro_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;los_params&quot;: (4.0, 5.0),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     &quot;Other&quot;: {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;interarrival_time&quot;: other_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                         &quot;los_params&quot;: (3.8, 5.2),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             }</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment = Experiment(experiment_params)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Run multiple replications</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             rep_results = multiple_replications(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 experiment, num_replications=num_replications</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Combine results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             asu_pdelay, rehab_pdelay = combine_pdelay_results(rep_results)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             asu_occup, rehab_occup = combine_occup_results(rep_results)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Calculate mean results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean_pdelay_asu = mean_results(asu_pdelay)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean_pdelay_rehab = mean_results(rehab_pdelay)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean_occup_asu = mean_results(asu_occup)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean_occup_rehab = mean_results(rehab_occup)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Create summary tables</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             asu_summary = summary_table(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 mean_pdelay_asu, min_beds=9, max_beds=14, bed_type=&quot;ASU&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             rehab_summary = summary_table(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 mean_pdelay_rehab, min_beds=10, max_beds=16, bed_type=&quot;Rehab&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Generate plots with dynamic ranges</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             x_range_asu = np.arange(len(mean_pdelay_asu))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             x_range_rehab = np.arange(len(mean_pdelay_rehab))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             fig_pd_asu, ax_pd_asu = prob_delay_plot(mean_pdelay_asu, x_range_asu)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             fig_pd_rehab, ax_pd_rehab = prob_delay_plot(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 mean_pdelay_rehab, x_range_rehab, &quot;No. rehab beds available&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             fig_occ_asu, ax_occ_asu = occupancy_plot(mean_occup_asu, x_range_asu)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             fig_occ_rehab, ax_occ_rehab = occupancy_plot(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 mean_occup_rehab, x_range_rehab, &quot;No. people in rehab&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Display results</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Acute Stroke Unit Results&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.table(asu_summary)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Rehabilitation Unit Results&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.table(rehab_summary)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Probability Delay Plots&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_pd_asu)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_pd_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Occupancy Plots&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_occ_asu)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_occ_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; if __name__ == &quot;__main__&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     main()</pre></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "pythonhealthdatascience/llm_simpy",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/03_stroke/02_model_stage2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01_asu_rehab_model.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Full model code</p>
      </div>
    </a>
    <a class="right-next"
       href="03_manual_testing_stage2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Manual model testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tests">Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-processing">Results processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-collection-tests">Results collection tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mode-run-tests">Mode run tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-number-set-test-asu-only">Random number set test (ASU only)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lognormal-test">Lognormal test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extreme-value-tests">Extreme value tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-tracing-functionality">Test tracing functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plotting-functions">Test plotting functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-streamlit-app">Test streamlit app</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-the-patienttype-methods">Test the <code class="docutils literal notranslate"><span class="pre">PatientType</span></code> methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-summary-table">Test <code class="docutils literal notranslate"><span class="pre">summary_table</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-all-automated-tests">Run all automated tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage-report">Test coverage report</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>