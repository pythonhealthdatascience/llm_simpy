
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Automated Model Testing &#8212; Using Generative AI to Reconstruct Healthcare Simulation Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/03_stroke/01_model_stage1/02_auto_testing';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Manual model testing" href="03_manual_testing.html" />
    <link rel="prev" title="Full model code" href="01_asu_rehab_model.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../front_page.html">
  
  
  
  
  
  
    <p class="title logo__title">Using Generative AI to Reconstruct Healthcare Simulation Models</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../front_page.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Aims</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../00_introduction/01_primary.html">Primary aims</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_introduction/02_literature.html">Related literature</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/01_overview.html">Procedure overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/02_recreation.html">Model recreation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/03_case_studies.html">Case study selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/04_design.html">Model design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/05_prompt_engineering.html">Prompt Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/06_testing.html">Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Critical Care Model</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/00_stress_report.html">STRESS report</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/03_data.html">3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/00_stress/06_code_access.html">6. Code access</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/01_model_stage1.html">Model Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/01_ccu_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/02_auto_testing.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/03_manual_testing.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/04_run_script.html">Run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/05_interface.html">Streamlit interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/01_model_stage1/06_sensitivity_analysis.html">Sensitivity Analysis Script</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/02_model_stage2.html">Model Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/02_model_stage2/01_ccu_model_stage2.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/02_model_stage2/02_auto_testing_stage2.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/02_model_stage2/03_manual_testing_stage2.html">Manual model testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_CCU/03_comparison.html">Model output comparison</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/04_prompts_stage1.html">Prompts Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/00_iteration.html">Iteration 0: unplanned arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/01_iteration.html">Iteration 1: treatment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/02_iteration.html">Iteration 2: elective patients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/03_iteration.html">Iteration 3: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/04_iteration.html">Iteration 4: warm-up period</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/05_iteration.html">Iteration 5: cancelled electives (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/06_iteration.html">Iteration 6: bed utilisation (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/07_iteration.html">Iteration 7: waiting time (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/08_iteration.html">Iteration 8: bed occupancy (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/09_iteration.html">Iteration 9: patient count (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/10_iteration.html">Iteration 10: multiple reps (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/11_iteration.html">Iteration 11: multiple reps (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/12_iteration.html">Iteration 12: multiple reps (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/13_iteration.html">Iteration 13: multiple reps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/14_iteration.html">Iteration 14: random number streams (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/15_iteration.html">Iteration 15: random number streams (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/16_iteration.html">Iteration 16: random number streams (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/17_iteration.html">Iteration 17: random number streams (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/18_iteration.html">Iteration 18: batching experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/19_iteration.html">Iteration 19: streamlit (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/20_iteration.html">Iteration 20: streamlit (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/21_iteration.html">Iteration 21: streamlit (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/04_prompts_stage1/22_iteration.html">Iteration 22: bug fix</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_CCU/05_prompts_stage2.html">Prompts Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/00_iteration_s2.html">Iteration 0: unplanned arrivals - stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/01_iteration_s2.html">Iteration 1: treatment - stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/02_iteration_s2.html">Iteration 2: elective patients - stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/03_iteration_s2.html">Iteration 3: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/04_iteration_s2.html">Iteration 4: warm-up period stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/05_iteration_s2.html">Iteration 5: cancelled electives (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/06_iteration_s2.html">Iteration 6: bed utilisation (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/07_iteration_s2.html">Iteration 7: waiting time (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/08_iteration_s2.html">Iteration 8: bed occupancy (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/09_iteration_s2.html">Iteration 9: patient count (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/10_iteration_s2.html">Iteration 10: multiple reps (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/11_iteration_s2.html">Iteration 11: multiple reps (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/12_iteration_s2.html">Iteration 12: multiple reps (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/13_iteration_s2.html">Iteration 13: multiple reps stage 2 (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/14_iteration_s2.html">Iteration 14: random number streams (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/15_iteration_s2.html">Iteration 15: random number streams (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/16_iteration_s2.html">Iteration 16: random number streams (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/17_iteration_s2.html">Iteration 17: random number streams (4) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/18_iteration_s2.html">Iteration 18: batching experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/19_iteration_s2.html">Iteration 19: streamlit (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/20_iteration_s2.html">Iteration 20: streamlit (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_CCU/05_prompts_stage2/21_iteration_s2.html">Iteration 21: streamlit (3) stage 2</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Stroke + Rehab model</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../00_stress_report.html">STRESS report</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/03_data.html">3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/06_code_access.html">6. Code access</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../01_model_stage1.html">Model Stage 1</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_asu_rehab_model.html">Full model code</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_manual_testing.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_run_script.html">Run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_interface.html">Streamlit interface</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02_model_stage2.html">Model Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/01_asu_rehab_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/02_auto_testing_stage2.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/03_manual_testing_stage2.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/04_run_script_stage2.html">Run script</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../03_comparison.html">Model output comparison</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04_asu_rehab_prompts.html">Prompts stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/01_iteration.html">Iteration 1: Acute Stroke Unit Arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/02_iteration.html">Iteration 2: Post stroke unit destination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/03_iteration.html">Iteration 3: Sample length of stay on the ASU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/04_iteration.html">Iteration 4: Fix the sampling from lognormal distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/05_iteration.html">Iteration 5: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/06_iteration.html">Iteration 6: add in a count of occupancy.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/07_iteration.html">Iteration 7: a trace function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/08_iteration.html">Iteration 8: auditing ASU occupancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/09_iteration.html">Iteration 9: ASU occupancy plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/10_iteration.html">Iteration 10: Blocking probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/11_iteration.html">Iteration 11: Return missing code</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/12_iteration.html">Iteration 12: External Rehab arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/13_iteration.html">Iteration 13: Organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/14_iteration.html">Iteration 14: Rehab treatment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/15_iteration.html">Iteration 15: Organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/16_iteration.html">Iteration 16: TIA rehab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/17_iteration.html">Iteration 17: Count occupancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/18_iteration.html">Iteration 18: Audit Rehab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/19_iteration.html">Iteration 19: Link models (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/20_iteration.html">Iteration 20: Link models (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/21_iteration.html">Iteration 21: Warm-up period</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/22_iteration.html">Iteration 22: Multiple Replications (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/23_iteration.html">Iteration 23: Multiple Replications (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/24_iteration.html">Iteration 24: Common Random Numbers (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/25_iteration.html">Iteration 25: Common Random Numbers (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/26_iteration.html">Iteration 26: Common Random Numbers (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/27_iteration.html">Iteration 27: Common Random Numbers (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/28_iteration.html">Iteration 28: streamlit (1)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/29_iteration.html">Iteration 29: streamlit (2)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/30_iteration.html">Iteration 30: streamlit (3)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/31_iteration.html">Iteration 30: Bug fix</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../05_asu_rehab_prompts_stage2.html">Prompts stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/01_iteration_s2.html">Iteration 1: Acute Stroke Unit Arrivals stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/02_iteration_s2.html">Iteration 2: Post stroke unit destination stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/03_iteration_s2.html">Iteration 3: Sample length of stay on the ASU stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/04_iteration_s2.html">Iteration 4: Check the sampling from lognormal distributions stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/05_iteration_s2.html">Iteration 5: organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/06_iteration_s2.html">Iteration 6: add in a count of occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/07_iteration_s2.html">Iteration 7: a trace function stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/08_iteration_s2.html">Iteration 8: auditing ASU occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/09_iteration_s2.html">Iteration 9: ASU occupancy plot stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/10_iteration_s2.html">Iteration 10: Blocking probability stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/11_iteration_s2.html">Iteration 11: Return missing code stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/12_iteration_s2.html">Iteration 12: External Rehab arrivals stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/13_iteration_s2.html">Iteration 13: Organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/14_iteration_s2.html">Iteration 14: Rehab treatment stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/15_iteration_s2.html">Iteration 15: Organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/16_iteration_s2.html">Iteration 16: TIA rehab stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/17_iteration_s2.html">Iteration 17: Count occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/18_iteration_s2.html">Iteration 18: Audit Rehab stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/19_iteration_s2.html">Iteration 19: Link models (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/20_iteration_s2.html">Iteration 20: Link models (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/21_iteration_s2.html">Iteration 21: Warm-up period stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/22_iteration_s2.html">Iteration 22: Multiple Replications (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/23_iteration_s2.html">Iteration 23: Multiple Replications (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/24_iteration_s2.html">Iteration 24: Common Random Numbers (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/25_iteration_s2.html">Iteration 25: Common Random Numbers (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/26_iteration_s2.html">Iteration 26: Common Random Numbers (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/27_iteration_s2.html">Iteration 27: Common Random Numbers (4) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/28_iteration_s2.html">Iteration 28: streamlit (1) stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/29_iteration_s2.html">Iteration 29: streamlit (2) stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/30_iteration_s2.html">Iteration 30: streamlit (3)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/31_iteration_s2.html">Iteration 30: Bug fix</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Results</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../04_results/01_CCU/00_model_comparison.html">CCU models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_results/02_stroke/00_model_comparison.html">Stroke+Rehab models</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/pythonhealthdatascience/llm_simpy/main?urlpath=lab/tree/notebooks/03_stroke/01_model_stage1/02_auto_testing.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pythonhealthdatascience/llm_simpy" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pythonhealthdatascience/llm_simpy/issues/new?title=Issue%20on%20page%20%2Fnotebooks/03_stroke/01_model_stage1/02_auto_testing.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/03_stroke/01_model_stage1/02_auto_testing.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Automated Model Testing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tests">Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-processing">Results processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-collection-tests">Results collection tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-run-tests">Model run tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-number-set-test-asu-only">Random number set test (ASU only)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lognormal-test">Lognormal test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extreme-value-tests">Extreme value tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-tracing-functionality">Test tracing functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plotting-functions">Test plotting functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-streamlit-app">Test streamlit app</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-all-automated-tests">Run all automated tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage-report">Test coverage report</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="automated-model-testing">
<h1>Automated Model Testing<a class="headerlink" href="#automated-model-testing" title="Link to this heading">#</a></h1>
<p>This notebook contains a set of automated tests for the Stroke+Rehab model.  These tests are either pass or fail and no interpretation is needed. A summary of test results is provided at the end of the notebook.</p>
<p>The stroke rehab model is imported within each test function because coverage measurement must begin before the module is imported and executed. When modules are imported at the top level of the notebook, all function definitions (def statements) are executed before pytest-cov starts measuring coverage, causing them to potentially be reported as uncovered lines.</p>
<p><strong>Additional testing:</strong> Beyond the original test suite defined in our methodology, we’ve included extra tests to enhance validation and coverage, based on peer review feedback.</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">simpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sim_tools.distributions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lognormal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">streamlit.testing.v1</span><span class="w"> </span><span class="kn">import</span> <span class="n">AppTest</span>

<span class="n">ipytest</span><span class="o">.</span><span class="n">autoconfig</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For formatting the coverage report</span>
<span class="n">module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">module_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">module_path</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">helper.format_coverage</span><span class="w"> </span><span class="kn">import</span> <span class="n">display_coverage</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Link to this heading">#</a></h2>
<section id="results-processing">
<h3>Results processing<a class="headerlink" href="#results-processing" title="Link to this heading">#</a></h3>
<p>A set of tests to check that the results of a simulated run are processed correctly for the user.</p>
<p>We test the processing of:</p>
<ul class="simple">
<li><p>occupancy frequencies</p></li>
<li><p>probability of delay</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;values, rel_expected, cum_expected&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> 
                           <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_result_processing_1</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">rel_expected</span><span class="p">,</span> <span class="n">cum_expected</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the `calculate_occupancy_frequencies` function works</span>
<span class="sd">    as expected.</span>

<span class="sd">    Expected result: relative frequencies and cumulative freqs</span>
<span class="sd">    are the same as expected values.</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    values: list</span>
<span class="sd">        list of values to test</span>

<span class="sd">    rel_expected: list</span>
<span class="sd">        list of floats - expected relative freqs</span>

<span class="sd">    cum_expected: list</span>
<span class="sd">        list of floats - expected cumulative freqs</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_occupancy_frequencies</span>

    <span class="n">rel</span><span class="p">,</span> <span class="n">cum</span><span class="p">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="n">calculate_occupancy_frequencies</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># use all close to allow for minor floating point differences.</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">rel</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">rel_expected</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cum_expected</span><span class="p">),</span> <span class="n">cum</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;relative, cum, p_delay_expected&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> 
                           <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="o">/</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="o">/</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">/</span><span class="mf">1.0</span><span class="p">])</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_result_processing_2</span><span class="p">(</span><span class="n">relative</span><span class="p">,</span> <span class="n">cum</span><span class="p">,</span> <span class="n">p_delay_expected</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the probability of delay is calculated correctly</span>
<span class="sd">    using the `calculate_prob_delay` function.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    relative: list</span>
<span class="sd">        list of floats - relative freqs</span>

<span class="sd">    cum: list</span>
<span class="sd">        list of floats - cumulative freqs</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the function pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_prob_delay</span>

    <span class="n">p_delay</span> <span class="o">=</span> <span class="n">calculate_prob_delay</span><span class="p">(</span><span class="n">relative</span><span class="p">,</span> <span class="n">cum</span><span class="p">)</span>
    <span class="c1"># use all close to allow for minor floating point differences.</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_delay_expected</span><span class="p">),</span> <span class="n">p_delay</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="results-collection-tests">
<h3>Results collection tests<a class="headerlink" href="#results-collection-tests" title="Link to this heading">#</a></h3>
<p>Test that the optional results collection processes for the ASU and REHAB models work correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_1</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the model collects acute stroke occupancy every day</span>

<span class="sd">    Expected result: len(experiment.occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span><span class="p">,</span> <span class="n">audit_acute_occupancy</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Initialize the Acute Stroke Unit model#</span>
    <span class="c1"># set ASU arr~ival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># modified iteration 19. </span>
    <span class="c1"># add RU, but do not run the model</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>

    <span class="c1"># optional results collection</span>
    <span class="c1"># Start the audit_acute_occupancy generator function to record ASU occupancy at intervals</span>
    <span class="c1"># MODIFIED iter 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">acu_experiment</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_2</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the model collects rehab occupancy every day</span>

<span class="sd">    Expected result: len(experiment.rehab_occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">audit_rehab_occupancy</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>

    <span class="c1"># create experiment</span>
    <span class="n">default_experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>
    
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment</span><span class="p">)</span>

    <span class="c1"># Initialise the patient generators as simpy processes</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
    
    <span class="c1"># Initialise the audit of rehab occupancy as a simpy process with an interval of 1 day</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">default_experiment</span><span class="p">))</span>
    
    <span class="c1"># Run the model for the default run length in the experiment</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_system</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    SYSTEM TEST</span>
<span class="sd">    </span>
<span class="sd">    Test REHAB ward occupancy data collected is in a sensible range</span>
<span class="sd">    when it is connected to the ASU model.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: The type collected is int. The values are in </span>
<span class="sd">    the range in the range 1 to [10-15] with sensible moments.</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(experiment.asu_occupancy) == env.now - 1 AND</span>
<span class="sd">        len(experiment.rehab_occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span><span class="p">,</span> <span class="n">audit_acute_occupancy</span><span class="p">,</span> <span class="n">audit_rehab_occupancy</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># a default experiment</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>

    <span class="c1"># Initialize the pREHAB atient generators as simpy processes</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>  

    <span class="c1"># optional results collection</span>
    <span class="c1"># Start the audit_acute_occupancy generator function to record ASU occupancy at intervals</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">acu_experiment</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>

    <span class="c1"># Initialize the audit of rehab occupancy as a simpy process with an interval of 1 day</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="c1"># print info for debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="model-run-tests">
<h2>Model run tests<a class="headerlink" href="#model-run-tests" title="Link to this heading">#</a></h2>
<p>Here we test that various modes of running the model work correctly.  These include</p>
<ul class="simple">
<li><p>results collection period</p></li>
<li><p>warm-up</p></li>
<li><p>single run mode</p></li>
<li><p>repeatable results using random number sets.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_results_collection_system</span><span class="p">(</span><span class="n">audit_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    SYSTEM TEST</span>
<span class="sd">    </span>
<span class="sd">    Test REHAB ward occupancy data collected is in a sensible range</span>
<span class="sd">    when it is connected to the ASU model.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: The type collected is int. The values are in </span>
<span class="sd">    the range in the range 1 to [10-15] with sensible moments.</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(experiment.asu_occupancy) == env.now - 1 AND</span>
<span class="sd">        len(experiment.rehab_occupancy) == env.now - 1</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span><span class="p">,</span> <span class="n">audit_acute_occupancy</span><span class="p">,</span> <span class="n">audit_rehab_occupancy</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># a default experiment</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>

    <span class="c1"># Initialize the pREHAB atient generators as simpy processes</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>  

    <span class="c1"># optional results collection</span>
    <span class="c1"># Start the audit_acute_occupancy generator function to record ASU occupancy at intervals</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">acu_experiment</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>

    <span class="c1"># Initialize the audit of rehab occupancy as a simpy process with an interval of 1 day</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="c1"># print info for debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;warm_up, audit_interval&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_warm_up</span><span class="p">(</span><span class="n">warm_up</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test warm-up works correctly for ASU+REHAB ward occupancy</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(experiment.asu_occupancy) == experiment.results_collection_period </span>
<span class="sd">        AND len(experiment.rehab_occupancy) == experiment.results_collection_period </span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    audit_interval: 1</span>
<span class="sd">        duration of audit.</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span><span class="p">,</span> <span class="n">audit_acute_occupancy</span><span class="p">,</span> <span class="n">audit_rehab_occupancy</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># a default experiment</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">warm_up</span><span class="o">=</span><span class="n">warm_up</span><span class="p">)</span>

    <span class="c1"># create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>

    <span class="c1"># Initialize the pREHAB atient generators as simpy processes</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>  

    <span class="c1"># optional results collection</span>
    <span class="c1"># Start the audit_acute_occupancy generator function to record ASU occupancy at intervals</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">warm_up</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">acu_experiment</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>

    <span class="c1"># Initialize the audit of rehab occupancy as a simpy process with an interval of 1 day</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_rehab_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">warm_up</span><span class="p">,</span> <span class="n">audit_interval</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">))</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">warm_up</span> <span class="o">+</span> <span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="c1"># print info for debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">warm_up</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span> <span class="ow">and</span> \
        <span class="nb">len</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">rehab_occupancy</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_single_run</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the the single_run function returns a dictionary of </span>
<span class="sd">    results.</span>

<span class="sd">    The results dictionary contains the following keys:</span>

<span class="sd">    &#39;relative_freq_asu&#39;</span>
<span class="sd">    &#39;prob_delay_asu&#39;</span>
<span class="sd">    &#39;unique_vals_asu&#39;</span>
<span class="sd">    &#39;relative_freq_rehab&#39;</span>
<span class="sd">    &#39;prob_delay_rehab&#39;</span>
<span class="sd">    &#39;unique_vals_rehab&#39;</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(run_results) == 6 and type(run_results) == dict</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">single_run</span>

    <span class="c1"># a default experiment</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">()</span>

    <span class="c1"># run the model</span>
    <span class="n">run_results</span> <span class="o">=</span> <span class="n">single_run</span><span class="p">(</span><span class="n">default_experiment_params</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run_results</span><span class="p">[</span><span class="s1">&#39;relative_freq_asu&#39;</span><span class="p">]</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">run_results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span>
</pre></div>
</div>
</div>
</div>
<section id="random-number-set-test-asu-only">
<h3>Random number set test (ASU only)<a class="headerlink" href="#random-number-set-test-asu-only" title="Link to this heading">#</a></h3>
<p>Test that ASU results are repeated each time the same random number set is used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;random_number_set, print_output&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_random_number_set_1</span><span class="p">(</span><span class="n">random_number_set</span><span class="p">,</span> <span class="n">print_output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the the ASU model produces repeatable results. </span>

<span class="sd">    Compares</span>
<span class="sd">    min, max, mean of occupancy.</span>
<span class="sd">    </span>
<span class="sd">    Expected result: </span>
<span class="sd">        set(run1) == set(run2)</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span><span class="p">,</span> <span class="n">audit_acute_occupancy</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        
        <span class="c1"># Create the simulation environment</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
        
        <span class="c1"># Initialize the Acute Stroke Unit model#</span>
        <span class="c1"># set ASU arr~ival rates</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">random_number_set</span><span class="o">=</span><span class="n">random_number_set</span><span class="p">)</span>
    
        <span class="c1"># modified iteration 19. </span>
        <span class="c1"># add RU, but do not run the model</span>
        <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">)</span>
        
        <span class="n">asu</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
        
        <span class="c1"># Start the patient generators for each type of patient</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">asu</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">asu</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">asu</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">asu</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
    
        <span class="c1"># optional results collection</span>
        <span class="c1"># Start the audit_acute_occupancy generator function to record ASU occupancy at intervals</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">audit_acute_occupancy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">asu</span><span class="p">,</span> <span class="n">experiment</span><span class="p">))</span>
        
        <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
        <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">experiment</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_output</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Run </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> results:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span> 
                            <span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span>
                            <span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">))))</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;random_number_set, print_output&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                          <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_random_number_set_2</span><span class="p">(</span><span class="n">random_number_set</span><span class="p">,</span> <span class="n">print_output</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test the the single_run function returns a dictionary of </span>
<span class="sd">    results.</span>

<span class="sd">    The results dictionary contains the following keys:</span>

<span class="sd">    &#39;relative_freq_asu&#39;</span>
<span class="sd">    &#39;prob_delay_asu&#39;</span>
<span class="sd">    &#39;unique_vals_asu&#39;</span>
<span class="sd">    &#39;relative_freq_rehab&#39;</span>
<span class="sd">    &#39;prob_delay_rehab&#39;</span>
<span class="sd">    &#39;unique_vals_rehab&#39;</span>

<span class="sd">    Expected result: </span>
<span class="sd">        len(run_results) == 6 and type(run_results) == dict</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool: does the model pass the test.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">single_run</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    
        <span class="c1"># set a random number set for streams</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">random_number_set</span><span class="o">=</span><span class="n">random_number_set</span><span class="p">)</span>
    
        <span class="c1"># run the model</span>
        <span class="n">run_results</span> <span class="o">=</span> <span class="n">single_run</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_output</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Run </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> results:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">)</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">quantiles</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span> 
                            <span class="nb">max</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">),</span>
                            <span class="n">statistics</span><span class="o">.</span><span class="n">fmean</span><span class="p">(</span><span class="n">experiment</span><span class="o">.</span><span class="n">asu_occupancy</span><span class="p">))))</span>
    
    <span class="c1"># test</span>
    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lognormal-test">
<h3>Lognormal test<a class="headerlink" href="#lognormal-test" title="Link to this heading">#</a></h3>
<p>Test that lognomal function correctly calculates the moments of the underlying normal dist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;mean, std&#39;</span><span class="p">,</span> <span class="p">[</span>
                          <span class="p">(</span><span class="mf">128.79</span><span class="p">,</span> <span class="mf">267.51</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
                          <span class="p">(</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_lognormal_moments</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Test that lognomal function correctly calculates </span>
<span class="sd">    the moments of the underlying normal dist.</span>

<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    mean: float</span>
<span class="sd">        mean of the lognormal distribution</span>

<span class="sd">    std: float</span>
<span class="sd">        st dev of the lognormal distribution</span>

<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">normal_moments_from_lognormal</span>
   
    <span class="c1"># Lognormal class from sim-tools.</span>
    <span class="n">expected_moments</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">expected_moments</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">expected_moments</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
    
    <span class="c1">## llm code</span>
    <span class="n">llm_mu</span><span class="p">,</span> <span class="n">llm_sigma</span> <span class="o">=</span> <span class="n">normal_moments_from_lognormal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">llm_mu</span><span class="p">,</span> <span class="n">llm_sigma</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="p">(</span><span class="n">llm_mu</span><span class="p">,</span> <span class="n">llm_sigma</span><span class="p">)</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">((</span><span class="n">expected_moments</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">expected_moments</span><span class="o">.</span><span class="n">sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="extreme-value-tests">
<h3>Extreme value tests<a class="headerlink" href="#extreme-value-tests" title="Link to this heading">#</a></h3>
<p>Extreme value tests are used pragmatically to block of routes/arrivals/activites in the simulation model and check the results.</p>
<p>The most simple way to modify the model for these tests is to set parameters to <span class="math notranslate nohighlight">\(M\)</span> a very large number.</p>
<p>We test</p>
<ul class="simple">
<li><p>Block all arrivals</p></li>
<li><p>Acute LoS is infinite</p></li>
<li><p>Block all but stroke-&gt;rehab patient arrivals in the ASU.</p></li>
<li><p>Block all rehab arrivals apart from stroke.</p></li>
<li><p>Block all external rehab arrivals</p></li>
<li><p>Rehab LoS is infinite (Rehab model only)</p></li>
<li><p>Block all arrivals to the ASU and Rehab models</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mi">10_000_000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_2</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have have their inter-arrival time is </span>
<span class="sd">    set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients arrive to the model.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    int: the number of patients that arrived to the model.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Initialize the Acute Stroke Unit model#</span>
    <span class="c1"># set ASU arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">stroke_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">tia_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">neuro_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">other_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># modified iteration 19. </span>
    <span class="c1"># add RU, but do not run the model</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 12</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_3</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have have their mean length </span>
<span class="sd">    of stay time set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients depart the model </span>
<span class="sd">    The number of arrivals = the occupancy of the model.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Initialize the Acute Stroke Unit model#</span>
    <span class="c1"># set ASU arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">rehab_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>  <span class="c1"># stroke-&gt;rehab</span>
        <span class="n">esd_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>    <span class="c1"># stroke-&gt; ESD</span>
        <span class="n">other_dest_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># stroke-&gt;other</span>
        <span class="n">tia_dest_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>   <span class="c1"># TIA patients</span>
        <span class="n">neuro_dest_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># complex neuro patients</span>
        <span class="n">other_dest_mean_2</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># other (med outlier) patients</span>
        <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># modified iteration 19. </span>
    <span class="c1"># add RU, but do not run the model</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">occupancy</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span> <span class="o">==</span> <span class="n">acu_experiment</span><span class="o">.</span><span class="n">occupancy</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_4</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types apart from stroke-rehab patients</span>
<span class="sd">    have have their mean length </span>
<span class="sd">    of stay time set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: Only stroke patients depart the</span>
<span class="sd">    model.</span>
<span class="sd">    (assessed crudely with patient_count &gt; occupancy),</span>
<span class="sd">    and also from log - see manual testing notebook.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Initialize the Acute Stroke Unit model#</span>
    <span class="c1"># set ASU arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">rehab_mean</span><span class="o">=</span><span class="mf">7.4</span><span class="p">,</span>  <span class="c1"># stroke-&gt;rehab</span>
        <span class="n">esd_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>    <span class="c1"># stroke-&gt; ESD</span>
        <span class="n">other_dest_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># stroke-&gt;other</span>
        <span class="n">tia_dest_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>   <span class="c1"># TIA patients</span>
        <span class="n">neuro_dest_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># complex neuro patients</span>
        <span class="n">other_dest_mean_2</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># other (med outlier) patients</span>
        <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># modified iteration 19. </span>
    <span class="c1"># add RU, but do not run the model</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">occupancy</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span> <span class="o">&gt;</span> <span class="n">acu_experiment</span><span class="o">.</span><span class="n">occupancy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_5</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Complex Neuro, Other, have their rehab inter-arrival </span>
<span class="sd">    time is set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: The only type of patient to arrive to the rehab model </span>
<span class="sd">    is &quot;Stroke&quot;. This is verified by the patient counts variables in the model.</span>

<span class="sd">    Notes:</span>
<span class="sd">    ------</span>
<span class="sd">    This test will need to be modified when the hardcoded parameters</span>
<span class="sd">    are migrated to the Experiment class. </span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool: rehab_unit.stroke_count == rehab_unit.patient_count</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># set Rehab arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">rehab_neuro_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="n">rehab_other_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># this will be need to be modified in subsequent iterations</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
        
    <span class="c1"># Start the patient generators for each type of patient in the RehabilitationUnit instance</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
        
    <span class="c1"># Run the simulation until the specified run length</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">1825</span><span class="p">)</span>

    <span class="c1"># print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_count</span> <span class="o">==</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_6</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have their REHAB inter-arrival </span>
<span class="sd">    time is set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients arrive to the model</span>
<span class="sd">    This is verified by the patient count variables in the model.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool:rehab_unit.patient_count == 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># set Rehab arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">rehab_stroke_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="n">rehab_neuro_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="n">rehab_other_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># this will be need to be modified in subsequent iterations</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    
    <span class="c1"># Start the patient generators for each type of patient in the RehabilitationUnit instance</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
        
    <span class="c1"># Run the simulation until the specified run length</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">1825</span><span class="p">)</span>

    <span class="c1"># print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">occupancy</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_7</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have have their mean length </span>
<span class="sd">    of stay time in REHAB set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients depart the rehab model </span>
<span class="sd">    The occupancy of the model is equal to the no. patient arrivals</span>
<span class="sd">    </span>
<span class="sd">    Notes:</span>
<span class="sd">    -----</span>
<span class="sd">    This test will also need to be modified when TIA treatment is added</span>
<span class="sd">    and tested when working in connection with the ASU.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># Initialize the Acute Stroke Unit model#</span>
    <span class="c1"># set ASU arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">rehab_stroke_esd_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># stroke-&gt;ESD</span>
        <span class="n">rehab_stroke_other_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># stroke-&gt;other</span>
        <span class="n">rehab_neuro_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># complex neuro</span>
        <span class="n">rehab_other_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span> <span class="c1"># other patients.</span>
        <span class="n">trace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>   
    <span class="p">)</span>

    <span class="c1"># this will be need to be modified in subsequent iterations</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    
    <span class="c1"># Start the patient generators for each type of patient in the instance</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>
        
    <span class="c1"># Run the simulation until the specified run length</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">occupancy</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span> <span class="o">==</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">occupancy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_ev_8</span><span class="p">(</span><span class="n">large_number</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    All patient types have their AUS and REHAB inter-arrival </span>
<span class="sd">    time is set to $M$ a very large number</span>
<span class="sd">    </span>
<span class="sd">    Expected result: No patients arrive to the model</span>
<span class="sd">    This is verified by the patient count variables in the model.</span>

<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    large_number: int</span>
<span class="sd">        M a very large number </span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    bool:rehab_unit.patient_count == 0 and asu.patient_count == 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">RehabilitationUnit</span><span class="p">,</span> <span class="n">AcuteStrokeUnit</span>

    <span class="c1"># Create the simulation environment</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    
    <span class="c1"># set Rehab arrival rates</span>
    <span class="n">default_experiment_params</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">stroke_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">tia_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">neuro_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">other_mean</span><span class="o">=</span><span class="n">large_number</span><span class="p">,</span>
        <span class="n">rehab_stroke_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="n">rehab_neuro_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
        <span class="n">rehab_other_iat</span> <span class="o">=</span> <span class="n">large_number</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># create models</span>
    <span class="n">rehab_unit</span> <span class="o">=</span> <span class="n">RehabilitationUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">)</span>
    <span class="n">acu_experiment</span> <span class="o">=</span> <span class="n">AcuteStrokeUnit</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">default_experiment_params</span><span class="p">,</span> <span class="n">rehab_unit</span><span class="p">)</span>
    
    <span class="c1"># Start the ASU patient generators for each type of patient</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">tia_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>

    <span class="c1"># Initialize the pREHAB atient generators as simpy processes</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_patient_generator</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_patient_generator</span><span class="p">())</span>  

    <span class="c1"># no optional data collection needed in this test</span>
    
    <span class="c1"># Run the simulation until the specified run length in the Experiment parameters</span>
    <span class="c1"># MODIFIED iter 21</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">default_experiment_params</span><span class="o">.</span><span class="n">results_collection_period</span><span class="p">)</span>

    <span class="c1"># print out stats collected</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">stroke_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">neuro_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">other_count</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rehab_unit</span><span class="o">.</span><span class="n">occupancy</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">rehab_unit</span><span class="o">.</span><span class="n">patient_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">acu_experiment</span><span class="o">.</span><span class="n">patient_count</span><span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-tracing-functionality">
<h3>Test tracing functionality<a class="headerlink" href="#test-tracing-functionality" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_trace</span><span class="p">(</span><span class="n">capsys</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify trace messages are printed when trace=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Experiment</span><span class="p">,</span> <span class="n">multiple_replications</span>

    <span class="c1"># Run the model once</span>
    <span class="n">default_experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">default_experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Capture printed output</span>
    <span class="n">captured</span> <span class="o">=</span> <span class="n">capsys</span><span class="o">.</span><span class="n">readouterr</span><span class="p">()</span>
    
    <span class="c1"># Check for some of the expected messages based on actual code</span>
    <span class="k">assert</span> <span class="s2">&quot;Stroke patient&quot;</span> <span class="ow">in</span> <span class="n">captured</span><span class="o">.</span><span class="n">out</span>
    <span class="k">assert</span> <span class="s2">&quot;finished treatment at&quot;</span> <span class="ow">in</span> <span class="n">captured</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-plotting-functions">
<h3>Test plotting functions<a class="headerlink" href="#test-plotting-functions" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_occupancy_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the output of occupancy_plot() is as expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">occupancy_plot</span>

    <span class="c1"># Create a plot with simple data</span>
    <span class="n">relative_frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">occupancy_plot</span><span class="p">(</span><span class="n">relative_frequency</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)</span>

    <span class="c1"># Check characteristics</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>  <span class="c1"># Should have 3 bars</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.5</span>  <span class="c1"># Check bar height</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;No. people in ASU&quot;</span>  <span class="c1"># Default label</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Relative Frequency&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>

    <span class="c1"># Close the figure to prevent display</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_prob_delay_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the output of prob_delay_plot() is as expected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">stroke_rehab_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">prob_delay_plot</span>

    <span class="c1"># Create a plot with simple data</span>
    <span class="n">prob_delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
    <span class="n">unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">prob_delay_plot</span><span class="p">(</span><span class="n">prob_delay</span><span class="p">,</span> <span class="n">unique_values</span><span class="p">)</span>
    
    <span class="c1"># Check characteristics</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Should have one step line</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;No. acute beds available&quot;</span>  <span class="c1"># Default label</span>
    <span class="k">assert</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylabel</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Probability of Delay&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>

    <span class="c1"># Close the figure to prevent display</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-streamlit-app">
<h3>Test streamlit app<a class="headerlink" href="#test-streamlit-app" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_streamlit_app_loads</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify that the streamlit app loads without errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run the app</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">AppTest</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;stroke_rehab_interface.py&quot;</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="c1"># Expected title</span>
    <span class="n">exp_title</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;A modelling tool for capacity planning in acute and &quot;</span> <span class="o">+</span>
                 <span class="s2">&quot;community stroke services&quot;</span><span class="p">)</span>

    <span class="c1"># Check that main elements are present</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">at</span><span class="o">.</span><span class="n">exception</span>
    <span class="k">assert</span> <span class="n">exp_title</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">number_input</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>  <span class="c1"># Patients, warm-up and replications</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">checkbox</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Trace checkbox</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">button</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># Simulate button</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_streamlit_simulate_button</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that clicking the simulate button runs the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run the app</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">AppTest</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;stroke_rehab_interface.py&quot;</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Run for 2 replications (else test times out)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">number_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Click simulate button</span>
    <span class="n">at</span><span class="o">.</span><span class="n">button</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Check that no exception occurred</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">at</span><span class="o">.</span><span class="n">exception</span>

    <span class="c1"># Get dataframes</span>
    <span class="n">acu_df</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">rehab_df</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    
    <span class="c1"># Expected values</span>
    <span class="n">expected_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p(delay)&#39;</span><span class="p">,</span> <span class="s1">&#39;1 in every n patients delayed&#39;</span><span class="p">]</span>
    <span class="n">expected_acu_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
    <span class="n">expected_rehab_index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
    
    <span class="c1"># Check columns (same for both dataframes)</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">acu_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_columns</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rehab_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_columns</span>
    
    <span class="c1"># Check index values</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">acu_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_acu_index</span>
    <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">rehab_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_rehab_index</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="run-all-automated-tests">
<h2>Run all automated tests<a class="headerlink" href="#run-all-automated-tests" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ipytest</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="s2">&quot;-vv&quot;</span><span class="p">,</span> <span class="s2">&quot;--no-header&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--cov=stroke_rehab_model&quot;</span><span class="p">,</span> <span class="s2">&quot;--cov=stroke_rehab_interface&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--cov-report=term&quot;</span><span class="p">,</span> <span class="s2">&quot;--cov-report=annotate&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">======================================= test session starts ========================================</span>
<span class=" -Color -Color-Bold">collecting ... </span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>collected 33 items

t_0cb721ee61904fc5be0d0b3577658354.py::test_result_processing_1[values0-rel_expected0-cum_expected0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED [  3%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_result_processing_2[relative0-cum0-p_delay_expected0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED [  6%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_results_collection_1 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                      [  9%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_results_collection_2 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                      [ 12%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_results_collection_system 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                 [ 15%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_warm_up[365-1] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                            [ 18%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_warm_up[1000-1] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                           [ 21%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_single_run 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                [ 24%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_1[0-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 27%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_1[1-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 30%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_1[2-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 33%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_1[101-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED            [ 36%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_1[42-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED             [ 39%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_2[0-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 42%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_2[1-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 45%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_2[2-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED              [ 48%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_2[101-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED            [ 51%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_random_number_set_2[42-False] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED             [ 54%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_lognormal_moments[128.79-267.51] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED          [ 57%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_lognormal_moments[50.0-2.0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED               [ 60%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_lognormal_moments[10.5-1.0] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED               [ 63%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_2 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 66%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_3 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 69%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_4 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 72%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_5 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 75%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_6 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 78%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_7 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">                                      [ 81%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_ev_8 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                      [ 84%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_trace 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                                     [ 87%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_occupancy_plot 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED                            [ 90%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_prob_delay_plot 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                           [ 93%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_streamlit_app_loads 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                       [ 96%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t_0cb721ee61904fc5be0d0b3577658354.py::test_streamlit_simulate_button 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">PASSED</span><span class=" -Color -Color-Yellow">                 [100%]</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">========================================= warnings summary =========================================</span>
t_0cb721ee61904fc5be0d0b3577658354.py::test_occupancy_plot
t_0cb721ee61904fc5be0d0b3577658354.py::test_occupancy_plot
t_0cb721ee61904fc5be0d0b3577658354.py::test_occupancy_plot
  /home/tom/miniforge3/envs/gen_simpy/lib/python3.10/site-packages/IPython/core/pylabtools.py:77: DeprecationWarning: backend2gui is deprecated since IPython 8.24, backends are managed in matplotlib and can be externally registered.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
========================================== tests coverage ==========================================
_________________________ coverage: platform linux, python 3.10.13-final-0 _________________________

Name                        Stmts   Miss  Cover
-----------------------------------------------
stroke_rehab_interface.py      45      0   100%
stroke_rehab_model.py         341      0   100%
-----------------------------------------------
TOTAL                         386      0   100%
Coverage annotated source written next to source
<span class=" -Color -Color-Yellow">================================== </span><span class=" -Color -Color-Green">33 passed</span>, <span class=" -Color -Color-Bold -Color-Bold-Yellow">3 warnings</span><span class=" -Color -Color-Yellow"> in 6.09s ==================================</span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ExitCode.OK: 0&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-coverage-report">
<h2>Test coverage report<a class="headerlink" href="#test-coverage-report" title="Link to this heading">#</a></h2>
<p>The percentage coverage is reported in the cell above. Below is the annotated report for the model. Grey lines (” “) are excluded, green lines (“&gt;”) are covered, and red lines (“!”) are not covered.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_coverage</span><span class="p">(</span><span class="s1">&#39;stroke_rehab_model.py,cover&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; &quot;&quot;&quot;A SimPy-based simulation model for analyzing patient flow in stroke care units.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; This module simulates the patient flow through an Acute Stroke Unit (ASU) and a connected</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Rehabilitation Unit to assist in capacity planning for acute and community stroke services.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; It models patient arrivals, treatment durations, and transitions between units using</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; statistical distributions to provide insights into occupancy levels and potential delays.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Authors: LLM implemented by Perplexity.AI</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Auto-formatted with `black` for PEP8 compliance.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Based on:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; ---------</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Monks et al. A modelling tool for capacity planning in acute</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; and community stroke services</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; https://link.springer.com/article/10.1186/s12913-016-1789-4</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; All functions and classes included in this module have been</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; generated between Jan-Mar 2024 by the LLM implemented by Perplexity.AI</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; https://www.perplexity.ai/</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Auto-formatting:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; ----------------</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; After generation was complete We used `black` to autoformat the code</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; to PEP8 standards</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Docstrings:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; -----------</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; After auto-formatting the file was uploaded to Perplexity.AI and the</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; following query was issued:</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; &#x27;Write PEP257 compliant docstrings for all functions, classes and methods.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; Provide a brief description of the purpose of the code, document parameters,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; and return values&#x27;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; All returned docstrings have been incorporated. This includes the initial</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; part of the module level docstring above.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import simpy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import numpy as np</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import pandas as pd</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import matplotlib.pyplot as plt</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">  # External function to convert Lognormal moments to Normal moments</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def normal_moments_from_lognormal(mean, std_dev):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Convert lognormal distribution moments to normal distribution moments.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - mean (float): The mean of the lognormal distribution.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - std_dev (float): The standard deviation of the lognormal distribution.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Returns:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - tuple: A tuple containing the mean (mu) and standard deviation (sigma) of the</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;              corresponding normal distribution.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     phi = np.sqrt(std_dev**2 + mean**2)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     mu = np.log(mean**2 / np.sqrt(std_dev**2 + mean**2))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     sigma = np.sqrt(np.log(phi**2 / mean**2))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return mu, sigma</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class Experiment:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;A class to set up and run the simulation experiment for stroke patient flow.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     This class initializes the simulation parameters, including patient arrival rates,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     treatment durations, and post-treatment destinations. It also sets up the simulation</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     environment and runs the simulation to collect occupancy data for analysis.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Attributes:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - Various parameters for initializing the simulation (see __init__ method).</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Methods:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - reset_kpi: Clears the occupancy data lists.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - setup_streams: Initializes random number streams for the simulation.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         stroke_mean=1.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         tia_mean=9.3,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         neuro_mean=3.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         other_mean=3.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_mean=7.4,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_std_dev=8.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         esd_mean=4.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         esd_std_dev=4.8,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         other_dest_mean=7.0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         other_dest_std_dev=8.7,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         tia_dest_mean=1.8,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         tia_dest_std_dev=5.0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         neuro_dest_mean=4.0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         neuro_dest_std_dev=5.0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         other_dest_mean_2=3.8,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         other_dest_std_dev_2=5.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         results_collection_period=1825,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         trace=False,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_stroke_iat=21.8,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_neuro_iat=31.7,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_other_iat=28.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_stroke_esd_mean=30.3,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_stroke_esd_std_dev=23.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_stroke_other_mean=28.4,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_stroke_other_std_dev=27.2,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_neuro_mean=27.6,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_neuro_std_dev=28.4,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_other_mean=16.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_other_std_dev=14.1,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_stroke_post_destination_prob=[0.4, 0.6],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_neuro_post_destination_prob=[0.09, 0.91],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rehab_other_post_destination_prob=[0.12, 0.88],</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         warm_up=1095,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         random_number_set=0,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.stroke_interarrival_mean = stroke_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.tia_interarrival_mean = tia_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.neuro_interarrival_mean = neuro_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_interarrival_mean = other_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_mean = rehab_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_std_dev = rehab_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.esd_mean = esd_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.esd_std_dev = esd_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_dest_mean = other_dest_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_dest_std_dev = other_dest_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.tia_dest_mean = tia_dest_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.tia_dest_std_dev = tia_dest_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.neuro_dest_mean = neuro_dest_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.neuro_dest_std_dev = neuro_dest_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_dest_mean_2 = other_dest_mean_2</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_dest_std_dev_2 = other_dest_std_dev_2</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.results_collection_period = results_collection_period</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.warm_up = warm_up  # New member variable for warm-up period</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.trace = trace</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.asu_occupancy = []  # List to store ASU occupancy data</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_occupancy = []  # List to store Rehabilitation Unit occupancy data</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # New parameters for RehabilitationUnit treatment distributions and probabilities</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_stroke_iat = rehab_stroke_iat</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_neuro_iat = rehab_neuro_iat</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_other_iat = rehab_other_iat</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_stroke_esd_mean = rehab_stroke_esd_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_stroke_esd_std_dev = rehab_stroke_esd_std_dev</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_stroke_other_mean = rehab_stroke_other_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_stroke_other_std_dev = rehab_stroke_other_std_dev</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_neuro_mean = rehab_neuro_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_neuro_std_dev = rehab_neuro_std_dev</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_other_mean = rehab_other_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_other_std_dev = rehab_other_std_dev</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Probabilities for post-rehab destination sampling</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # for each patient type in RehabilitationUnit</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_stroke_post_destination_prob = rehab_stroke_post_destination_prob</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_neuro_post_destination_prob = rehab_neuro_post_destination_prob</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_other_post_destination_prob = rehab_other_post_destination_prob</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Call the setup_streams method with the provided random_number_set parameter</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.setup_streams(random_number_set)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def reset_kpi(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;Reset the key performance indicators (occupancy lists) to empty.&quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.asu_occupancy.clear()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_occupancy.clear()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def setup_streams(self, random_number_set):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;Setup random number streams based on the provided seed.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         - random_number_set (int): The seed for generating random number streams.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Create an empty list to store random number generator objects</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.streams = []</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Create a numpy random default_rng generator</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # object using random_number_set as a seed.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rng_seed_generator = np.random.default_rng(random_number_set)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Generate a list of 25 random integer seeds sampled from</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # a uniform distribution with lower bound 0 and upper bound</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # equal to the system&#x27;s maximum 64-bit integer size.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         seeds = rng_seed_generator.integers(0, np.iinfo(np.int64).max, size=25)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Loop through the seeds and create a new numpy random default_rng</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # object for each seed and append it to the streams list.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for seed in seeds:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             rng_obj = np.random.default_rng(seed)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.streams.append(rng_obj)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class AcuteStrokeUnit:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;A class representing the Acute Stroke Unit in the simulation.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     This class models the arrival and acute treatment of stroke patients, tracking occupancy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     and simulating the duration of stay based on treatment type.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Attributes:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - env (simpy.Environment): The simulation environment.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - experiment (Experiment): The experiment configuration.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - rehab_unit (RehabilitationUnit): The connected Rehabilitation Unit.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Methods:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - stroke_acute_treatment, tia_acute_treatment, etc.: Simulate the treatment process.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - stroke_patient_generator, tia_patient_generator, etc.: Generate patients over time.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(self, env, experiment, rehab_unit):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;Initialize the Acute Stroke Unit with the simulation environment and parameters.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         - env (simpy.Environment): The simulation environment.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         - experiment (Experiment): The experiment configuration.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         - rehab_unit (RehabilitationUnit): The connected Rehabilitation Unit.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env = env</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.experiment = experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.rehab_unit = rehab_unit</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.patient_count = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy = 0</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_acute_treatment(self, post_asu_destination):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;Simulate the acute treatment process for a stroke patient.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         - post_asu_destination (str): The destination of the patient after ASU treatment.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         The method simulates the treatment duration and updates occupancy accordingly.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_mean, self.experiment.rehab_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             length_of_stay = self.experiment.streams[0].lognormal(mean=mu, sigma=sigma)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         elif post_asu_destination == &quot;ESD&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.esd_mean, self.experiment.esd_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             length_of_stay = self.experiment.streams[1].lognormal(mean=mu, sigma=sigma)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.other_dest_mean, self.experiment.other_dest_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             length_of_stay = self.experiment.streams[2].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy += 1  # Increment occupancy when a patient arrives</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Stroke patient {self.patient_count} finished treatment at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1  # Decrement occupancy at the end of treatment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.rehab_unit.stroke_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def tia_acute_treatment(self, post_asu_destination):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.experiment.tia_dest_mean, self.experiment.tia_dest_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[3].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy += 1  # Increment occupancy when a patient arrives</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;TIA patient {self.patient_count} finished treatment at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1  # Decrement occupancy at the end of treatment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.rehab_unit.tia_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def neuro_acute_treatment(self, post_asu_destination):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.experiment.neuro_dest_mean, self.experiment.neuro_dest_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[4].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy += 1  # Increment occupancy when a patient arrives</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Complex Neuro patient {self.patient_count} finished treatment at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1  # Decrement occupancy at the end of treatment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.rehab_unit.neuro_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_acute_treatment(self, post_asu_destination):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.experiment.other_dest_mean_2, self.experiment.other_dest_std_dev_2</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[5].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy += 1  # Increment occupancy when a patient arrives</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Other patient {self.patient_count} finished treatment at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1  # Decrement occupancy at the end of treatment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_asu_destination == &quot;Rehab&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.rehab_unit.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.rehab_unit.other_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[6].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.stroke_interarrival_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_destination = self.experiment.streams[7].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 [&quot;Rehab&quot;, &quot;ESD&quot;, &quot;Other&quot;], p=[0.24, 0.13, 0.63]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Stroke patient {self.patient_count} arrived at {self.env.now} days and will go to {post_asu_destination}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.stroke_acute_treatment(post_asu_destination))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def tia_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[8].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.tia_interarrival_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_destination = self.experiment.streams[9].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 [&quot;Rehab&quot;, &quot;ESD&quot;, &quot;Other&quot;], p=[0.01, 0.01, 0.98]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;TIA patient {self.patient_count} arrived at {self.env.now} days and will go to {post_asu_destination}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.tia_acute_treatment(post_asu_destination))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def neuro_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[10].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.neuro_interarrival_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_destination = self.experiment.streams[11].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 [&quot;Rehab&quot;, &quot;ESD&quot;, &quot;Other&quot;], p=[0.11, 0.05, 0.84]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Complex Neuro patient {self.patient_count} arrived at {self.env.now} days and will go to {post_asu_destination}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.neuro_acute_treatment(post_asu_destination))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[12].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.other_interarrival_mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             post_asu_destination = self.experiment.streams[13].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 [&quot;Rehab&quot;, &quot;ESD&quot;, &quot;Other&quot;], p=[0.05, 0.10, 0.85]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Other patient {self.patient_count} arrived at {self.env.now} days and will go to {post_asu_destination}&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.other_acute_treatment(post_asu_destination))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; class RehabilitationUnit:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;A class representing the Rehabilitation Unit in the simulation.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     This class models the rehabilitation treatment of patients, tracking occupancy and</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     simulating the duration of stay based on post-rehabilitation destinations.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Attributes and methods are similar in purpose to those of the AcuteStrokeUnit class.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def __init__(self, env, experiment):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.env = env</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.experiment = experiment</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.patient_count = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.stroke_count = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.neuro_count = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.other_count = 0</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy = 0</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[14].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_stroke_iat</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.stroke_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Stroke patient {self.patient_count} arrived at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.stroke_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def neuro_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[15].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_neuro_iat</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.neuro_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Complex Neurological patient {self.patient_count} arrived at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.neuro_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_patient_generator(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             interarrival_time = self.experiment.streams[16].exponential(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_other_iat</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             yield self.env.timeout(interarrival_time)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.patient_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.other_count += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                     f&quot;Other patient {self.patient_count} arrived at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.occupancy += 1</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.env.process(self.other_rehab_treatment())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def tia_rehab_treatment(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[17].choice([0, 100])</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         mu, sigma = normal_moments_from_lognormal(18.7, 23.5)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[18].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;TIA patient {self.patient_count} finished treatment at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def stroke_rehab_treatment(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[19].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;], p=self.experiment.rehab_stroke_post_destination_prob</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if post_rehab_destination == &quot;ESD&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_stroke_esd_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_stroke_esd_std_dev,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         else:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_stroke_other_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 self.experiment.rehab_stroke_other_std_dev,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[20].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Stroke patient {self.patient_count} finished treatment at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def neuro_rehab_treatment(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[21].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;], p=self.experiment.rehab_neuro_post_destination_prob</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.experiment.rehab_neuro_mean, self.experiment.rehab_neuro_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[22].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Complex Neurological patient {self.patient_count} finished treatment at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     def other_rehab_treatment(self):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         post_rehab_destination = self.experiment.streams[23].choice(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             [&quot;ESD&quot;, &quot;Other&quot;], p=self.experiment.rehab_other_post_destination_prob</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         mu, sigma = normal_moments_from_lognormal(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             self.experiment.rehab_other_mean, self.experiment.rehab_other_std_dev</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         length_of_stay = self.experiment.streams[24].lognormal(mean=mu, sigma=sigma)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield self.env.timeout(length_of_stay)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         if self.experiment.trace:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             print(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 f&quot;Other patient {self.patient_count} finished treatment at Rehabilitation Unit at {self.env.now} days&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         self.occupancy -= 1</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def audit_acute_occupancy(env, first_interval, audit_interval, asu, experiment):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Record the occupancy of the Acute Stroke Unit at regular intervals.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - env (simpy.Environment): The simulation environment.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - first_interval (int): The initial delay before starting the audit.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - audit_interval (int): The interval between occupancy recordings.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - asu (AcuteStrokeUnit): The Acute Stroke Unit being audited.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - experiment (Experiment): The experiment configuration.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     yield env.timeout(first_interval)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment.asu_occupancy.append(asu.occupancy)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield env.timeout(audit_interval)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def audit_rehab_occupancy(env, first_interval, audit_interval, rehab_unit, experiment):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Record the occupancy of the Rehabilitation Unit at regular intervals.&quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     yield env.timeout(first_interval)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     while True:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment.rehab_occupancy.append(rehab_unit.occupancy)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         yield env.timeout(audit_interval)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def calculate_occupancy_frequencies(data):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     unique_values, counts = np.unique(data, return_counts=True)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     relative_frequency = counts / len(data)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     cumulative_frequency = np.cumsum(relative_frequency)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return relative_frequency, cumulative_frequency, unique_values</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def occupancy_plot(relative_frequency, unique_values, x_label=&quot;No. people in ASU&quot;, fig_size=(12, 5)):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Generate a plot of the occupancy relative frequency distribution.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - relative_frequency (numpy.ndarray): The relative frequencies of occupancy levels.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - unique_values (numpy.ndarray): The unique occupancy levels observed.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - x_label (str): The label for the x-axis.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - fig_size (tuple): The size of the figure.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Returns:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - matplotlib.figure.Figure, matplotlib.axes.Axes: The figure and axes of the plot.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     fig, ax = plt.subplots(figsize=fig_size)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.bar(unique_values, relative_frequency, align=&#x27;center&#x27;, alpha=0.7)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Dynamically set x-axis ticks based on the range of unique values</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_value = max(unique_values)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     tick_step = max(1, max_value // 10)  # Ensure at least 10 ticks, but not more than the number of unique values</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xticks(np.arange(0, max_value + 1, tick_step))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xlabel(x_label)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_ylabel(&#x27;Relative Frequency&#x27;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     plt.grid(axis=&#x27;y&#x27;, linestyle=&#x27;--&#x27;, alpha=0.6)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     plt.title(&#x27;Occupancy Relative Frequency Distribution&#x27;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     plt.tight_layout()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return fig, ax</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def calculate_prob_delay(relative_frequencies, cumulative_frequencies):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay = np.array(relative_frequencies) / np.array(cumulative_frequencies)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return prob_delay</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def prob_delay_plot(prob_delay, unique_values, x_label=&quot;No. acute beds available&quot;, fig_size=(12, 5)):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     fig, ax = plt.subplots(figsize=fig_size)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.step(unique_values, prob_delay, where=&#x27;post&#x27;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Dynamically set x-axis ticks based on the range of unique values</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_value = max(unique_values)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     tick_step = max(1, max_value // 10)  # Ensure at least 10 ticks, but not more than the number of unique values</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xticks(np.arange(0, max_value + 1, tick_step))</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_xlabel(x_label)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ax.set_ylabel(&#x27;Probability of Delay&#x27;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     plt.grid(axis=&#x27;y&#x27;, linestyle=&#x27;--&#x27;, alpha=0.6)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     plt.title(&#x27;Probability of Delay Distribution&#x27;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     plt.tight_layout()</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return fig, ax</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def single_run(experiment):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Run a single simulation with the provided experiment configuration.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - experiment (Experiment): The experiment configuration.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Returns:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - dict: A dictionary containing the occupancy frequencies and</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     probability of delay for both the Acute Stroke Unit and the Rehabilitation Unit.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     experiment.reset_kpi()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env = simpy.Environment()</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Create an instance of RehabilitationUnit and AcuteStrokeUnit</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # with the Experiment parameters</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rehab_unit = RehabilitationUnit(env, experiment)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     acu_experiment = AcuteStrokeUnit(env, experiment, rehab_unit)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Initialize patient generators as simpy processes in both units</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(acu_experiment.stroke_patient_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(acu_experiment.tia_patient_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(acu_experiment.neuro_patient_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(acu_experiment.other_patient_generator())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(rehab_unit.stroke_patient_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(rehab_unit.neuro_patient_generator())</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(rehab_unit.other_patient_generator())</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Initialize audit functions for both units to record occupancy at intervals</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         audit_rehab_occupancy(env, experiment.warm_up, 1, rehab_unit, experiment)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.process(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         audit_acute_occupancy(env, experiment.warm_up, 1, acu_experiment, experiment)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Run the simulation for the specified period (results_collection_period + warm_up)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     env.run(until=experiment.results_collection_period + experiment.warm_up)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Calculate occupancy frequencies and probability of</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # delay for both units and return the results in a dictionary</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     (</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         relative_freq_asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         cumulative_freq_asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ) = calculate_occupancy_frequencies(experiment.asu_occupancy)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     (</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         relative_freq_rehab,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         cumulative_freq_rehab,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_rehab,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     ) = calculate_occupancy_frequencies(experiment.rehab_occupancy)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay_asu = calculate_prob_delay(relative_freq_asu, cumulative_freq_asu)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     prob_delay_rehab = calculate_prob_delay(relative_freq_rehab, cumulative_freq_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;relative_freq_asu&quot;: relative_freq_asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;prob_delay_asu&quot;: prob_delay_asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;unique_vals_asu&quot;: unique_vals_asu,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;relative_freq_rehab&quot;: relative_freq_rehab,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;prob_delay_rehab&quot;: prob_delay_rehab,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         &quot;unique_vals_rehab&quot;: unique_vals_rehab,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     }</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def multiple_replications(experiment_instance, num_replications=5):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Run multiple simulations with the provided experiment configuration</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     and number of replications.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - experiment (Experiment): The experiment configuration.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - num_replications (int): The number of simulations to run.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Returns:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - list: A list of dictionaries, each containing the occupancy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     frequencies and probability of delay for both the Acute Stroke Unit</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     and the Rehabilitation Unit from a single simulation run.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     rep_results = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for replication_number in range(num_replications):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         experiment_instance.setup_streams(replication_number)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         rep_results.append(single_run(experiment_instance))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return rep_results</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def combine_pdelay_results(rep_results):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Combine the probability of delay results from multiple simulation runs.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - results (list): A list of dictionaries, each containing the occupancy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     frequencies and probability of delay for both the Acute Stroke Unit and</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     the Rehabilitation Unit from a single simulation run.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     result_list_asu = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     result_list_rehab = []</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_occupancy_asu = max(max(rep[&#x27;unique_vals_asu&#x27;]) for rep in rep_results)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_occupancy_rehab = max(max(rep[&#x27;unique_vals_rehab&#x27;]) for rep in rep_results)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for rep_result in rep_results:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         prob_delay_asu = rep_result[&#x27;prob_delay_asu&#x27;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_asu = rep_result[&#x27;unique_vals_asu&#x27;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         min_occupancy_asu = min(unique_vals_asu)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         new_array_asu = np.zeros(max_occupancy_asu + 1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for i, val in zip(unique_vals_asu, prob_delay_asu):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             new_array_asu[i] = val</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         new_array_asu[:min_occupancy_asu] = 1.0</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         result_list_asu.append(new_array_asu)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         prob_delay_rehab = rep_result[&#x27;prob_delay_rehab&#x27;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_rehab = rep_result[&#x27;unique_vals_rehab&#x27;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         min_occupancy_rehab = min(unique_vals_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         new_array_rehab = np.zeros(max_occupancy_rehab + 1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for i, val in zip(unique_vals_rehab, prob_delay_rehab):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             new_array_rehab[i] = val</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         new_array_rehab[:min_occupancy_rehab] = 1.0</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         result_list_rehab.append(new_array_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return np.array(result_list_asu), np.array(result_list_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def combine_occup_results(rep_results):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Combine the occupancy frequency results from multiple simulation runs.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - results (list): A list of dictionaries, each containing the occupancy</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     frequencies and probability of delay for both the Acute Stroke Unit</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     and the Rehabilitation Unit from a single simulation run.</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     result_list_asu = []</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     result_list_rehab = []</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_occupancy_asu = max(max(rep[&#x27;unique_vals_asu&#x27;]) for rep in rep_results)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     max_occupancy_rehab = max(max(rep[&#x27;unique_vals_rehab&#x27;]) for rep in rep_results)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     for rep_result in rep_results:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         relative_freq_asu = rep_result[&#x27;relative_freq_asu&#x27;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_asu = rep_result[&#x27;unique_vals_asu&#x27;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         new_array_asu = np.zeros(max_occupancy_asu + 1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for i, val in zip(unique_vals_asu, relative_freq_asu):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             new_array_asu[i] = val</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         result_list_asu.append(new_array_asu)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         relative_freq_rehab = rep_result[&#x27;relative_freq_rehab&#x27;]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         unique_vals_rehab = rep_result[&#x27;unique_vals_rehab&#x27;]</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         new_array_rehab = np.zeros(max_occupancy_rehab + 1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         for i, val in zip(unique_vals_rehab, relative_freq_rehab):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             new_array_rehab[i] = val</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         result_list_rehab.append(new_array_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return np.array(result_list_asu), np.array(result_list_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def mean_results(rep_results):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return np.mean(rep_results, axis=0)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def summary_table(mean_pdelay, min_beds, max_beds, bed_type):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;Generate a summary table of the occupancy frequencies</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     and probability of delay results.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Parameters:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     - results (dict): The combined occupancy frequency and</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     probability of delay results for both the Acute Stroke Unit</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     and the Rehabilitation Unit.</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     &quot;&quot;&quot;</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     sliced_mean_pdelay = mean_pdelay[min_beds : max_beds + 1]</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     inv_mean_pdelay = 1 / sliced_mean_pdelay</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     inv_mean_pdelay_rounded = np.floor(inv_mean_pdelay).astype(int)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     df_summary_table = pd.DataFrame(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         {</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;p(delay)&quot;: sliced_mean_pdelay.round(2),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             &quot;1 in every n patients delayed&quot;: inv_mean_pdelay_rounded,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         },</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         index=pd.Index(range(min_beds, max_beds + 1), name=&quot;No. &quot; + bed_type + &quot; beds&quot;),</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     return df_summary_table</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_coverage</span><span class="p">(</span><span class="s1">&#39;stroke_rehab_interface.py,cover&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import streamlit as st</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; import numpy as np</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; from stroke_rehab_model import (</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     Experiment, multiple_replications, combine_pdelay_results,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     combine_occup_results, mean_results, prob_delay_plot,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     occupancy_plot, summary_table</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; def main():</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.title(&quot;A modelling tool for capacity planning in acute and community stroke services&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(&quot;This model is a recreation of the model reported in a published academic study.&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(&quot;Original study citation:&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(&quot;Monks T, Worthington D, Allen M, Pitt M, Stein K, James MA. A modelling tool for capacity planning in acute and community stroke services. BMC Health Serv Res. 2016 Sep 29;16(1):530. doi: 10.1186/s12913-016-1789-4. PMID: 27688152; PMCID: PMC5043535.&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.write(&quot;Link to the original study: [https://doi.org/10.1186/s12913-016-1789-4](https://doi.org/10.1186/s12913-016-1789-4)&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Sidebar for Experiment parameters</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.sidebar.header(&quot;Simulation Parameters&quot;)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Inter-arrival rates</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.sidebar.subheader(&quot;Inter-arrival Rates&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     stroke_mean = st.sidebar.number_input(&quot;Stroke patients&quot;, value=1.2, step=0.1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     tia_mean = st.sidebar.number_input(&quot;TIA patients&quot;, value=9.3, step=0.1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     neuro_mean = st.sidebar.number_input(&quot;Complex Neurological patients&quot;, value=3.6, step=0.1)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     other_mean = st.sidebar.number_input(&quot;Other patients&quot;, value=3.2, step=0.1)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Model control</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     st.sidebar.subheader(&quot;Model Control&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     trace = st.sidebar.checkbox(&quot;Trace patients in simulation&quot;, value=False)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     warm_up = st.sidebar.number_input(&quot;Warm-up period&quot;, value=1095, step=1)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">      # Number of replications</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     num_replications = st.number_input(&quot;Number of replications&quot;, value=100, min_value=1, step=1)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     if st.button(&quot;Simulate&quot;):</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         with st.spinner(&quot;Please wait for results...&quot;):</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Create an instance of Experiment with user-defined parameters</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             experiment = Experiment(</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 stroke_mean=stroke_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 tia_mean=tia_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 neuro_mean=neuro_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 other_mean=other_mean,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 trace=trace,</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;                 warm_up=warm_up</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             )</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Run multiple replications</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             rep_results = multiple_replications(experiment, num_replications)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">              # Combine results and take the mean</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             pd_asu, pd_rehab = combine_pdelay_results(rep_results)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             rel_asu, rel_rehab = combine_occup_results(rep_results)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean_pd_asu, mean_pd_rehab = mean_results(pd_asu), mean_results(pd_rehab)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;             mean_rel_asu, mean_rel_rehab = mean_results(rel_asu), mean_results(rel_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Display tables</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Acute Care Results&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         df_acute = summary_table(mean_pd_asu, 9, 14, &quot;acute&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.table(df_acute)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Rehabilitation Results&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         df_rehab = summary_table(mean_pd_rehab, 10, 16, &quot;rehab&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.table(df_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">          # Display plots</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Probability Delay Plots&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         fig_pd_asu, ax_pd_asu = prob_delay_plot(mean_pd_asu, np.arange(len(mean_pd_asu)))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_pd_asu)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         fig_pd_rehab, ax_pd_rehab = prob_delay_plot(mean_pd_rehab, np.arange(len(mean_pd_rehab)), &quot;No. rehab beds available&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_pd_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.subheader(&quot;Occupancy Plots&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         fig_occ_asu, ax_occ_asu = occupancy_plot(mean_rel_asu, np.arange(len(mean_rel_asu)))</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_occ_asu)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         fig_occ_rehab, ax_occ_rehab = occupancy_plot(mean_rel_rehab, np.arange(len(mean_rel_rehab)), &quot;No. people in rehab&quot;)</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;         st.pyplot(fig_occ_rehab)</pre><pre style="font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;"></pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt; if __name__ == &quot;__main__&quot;:</pre><pre style="background-color: #ccffcc; font-family: monospace; font-size: 10px; margin: 0; padding: 0; line-height: 1; white-space: pre-wrap;">&gt;     main()</pre></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "pythonhealthdatascience/llm_simpy",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/03_stroke/01_model_stage1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01_asu_rehab_model.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Full model code</p>
      </div>
    </a>
    <a class="right-next"
       href="03_manual_testing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Manual model testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tests">Tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-processing">Results processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-collection-tests">Results collection tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-run-tests">Model run tests</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-number-set-test-asu-only">Random number set test (ASU only)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lognormal-test">Lognormal test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extreme-value-tests">Extreme value tests</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-tracing-functionality">Test tracing functionality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-plotting-functions">Test plotting functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-streamlit-app">Test streamlit app</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-all-automated-tests">Run all automated tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage-report">Test coverage report</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>