
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sensitivity Analysis Script &#8212; Using Generative AI to Reconstruct Healthcare Simulation Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/02_CCU/01_model_stage1/06_sensitivity_analysis';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Model Stage 2" href="../02_model_stage2.html" />
    <link rel="prev" title="Streamlit interface" href="05_interface.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../front_page.html">
  
  
  
  
  
  
    <p class="title logo__title">Using Generative AI to Reconstruct Healthcare Simulation Models</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../front_page.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Aims</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../00_introduction/01_primary.html">Primary aims</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_introduction/02_literature.html">Related literature</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/01_overview.html">Procedure overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/02_recreation.html">Model recreation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/03_case_studies.html">Case study selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/04_design.html">Model design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/05_prompt_engineering.html">Prompt Engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_methods/06_testing.html">Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Critical Care Model</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../00_stress_report.html">STRESS report</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/03_data.html">3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../00_stress/06_code_access.html">6. Code access</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../01_model_stage1.html">Model Stage 1</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_ccu_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_auto_testing.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_manual_testing.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_run_script.html">Run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_interface.html">Streamlit interface</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Sensitivity Analysis Script</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02_model_stage2.html">Model Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/01_ccu_model_stage2.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/02_auto_testing_stage2.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_model_stage2/03_manual_testing_stage2.html">Manual model testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../03_comparison.html">Model output comparison</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04_prompts_stage1.html">Prompts Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/00_iteration.html">Iteration 0: unplanned arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/01_iteration.html">Iteration 1: treatment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/02_iteration.html">Iteration 2: elective patients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/03_iteration.html">Iteration 3: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/04_iteration.html">Iteration 4: warm-up period</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/05_iteration.html">Iteration 5: cancelled electives (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/06_iteration.html">Iteration 6: bed utilisation (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/07_iteration.html">Iteration 7: waiting time (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/08_iteration.html">Iteration 8: bed occupancy (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/09_iteration.html">Iteration 9: patient count (KPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/10_iteration.html">Iteration 10: multiple reps (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/11_iteration.html">Iteration 11: multiple reps (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/12_iteration.html">Iteration 12: multiple reps (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/13_iteration.html">Iteration 13: multiple reps (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/14_iteration.html">Iteration 14: random number streams (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/15_iteration.html">Iteration 15: random number streams (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/16_iteration.html">Iteration 16: random number streams (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/17_iteration.html">Iteration 17: random number streams (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/18_iteration.html">Iteration 18: batching experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/19_iteration.html">Iteration 19: streamlit (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/20_iteration.html">Iteration 20: streamlit (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/21_iteration.html">Iteration 21: streamlit (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_prompts_stage1/22_iteration.html">Iteration 22: bug fix</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../05_prompts_stage2.html">Prompts Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/00_iteration_s2.html">Iteration 0: unplanned arrivals - stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/01_iteration_s2.html">Iteration 1: treatment - stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/02_iteration_s2.html">Iteration 2: elective patients - stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/03_iteration_s2.html">Iteration 3: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/04_iteration_s2.html">Iteration 4: warm-up period stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/05_iteration_s2.html">Iteration 5: cancelled electives (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/06_iteration_s2.html">Iteration 6: bed utilisation (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/07_iteration_s2.html">Iteration 7: waiting time (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/08_iteration_s2.html">Iteration 8: bed occupancy (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/09_iteration_s2.html">Iteration 9: patient count (KPI) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/10_iteration_s2.html">Iteration 10: multiple reps (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/11_iteration_s2.html">Iteration 11: multiple reps (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/12_iteration_s2.html">Iteration 12: multiple reps (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/13_iteration_s2.html">Iteration 13: multiple reps stage 2 (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/14_iteration_s2.html">Iteration 14: random number streams (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/15_iteration_s2.html">Iteration 15: random number streams (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/16_iteration_s2.html">Iteration 16: random number streams (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/17_iteration_s2.html">Iteration 17: random number streams (4) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/18_iteration_s2.html">Iteration 18: batching experiments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/19_iteration_s2.html">Iteration 19: streamlit (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/20_iteration_s2.html">Iteration 20: streamlit (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_prompts_stage2/21_iteration_s2.html">Iteration 21: streamlit (3) stage 2</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Stroke + Rehab model</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_stroke/00_stress_report.html">STRESS report</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/00_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/00_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/00_stress/03_data.html">3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/00_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/00_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/00_stress/06_code_access.html">6. Code access</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_stroke/01_model_stage1.html">Model Stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/01_model_stage1/01_asu_rehab_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/01_model_stage1/02_auto_testing.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/01_model_stage1/03_manual_testing.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/01_model_stage1/04_run_script.html">Run script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/01_model_stage1/05_interface.html">Streamlit interface</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_stroke/02_model_stage2.html">Model Stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/02_model_stage2/01_asu_rehab_model.html">Full model code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/02_model_stage2/02_auto_testing_stage2.html">Automated Model Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/02_model_stage2/03_manual_testing_stage2.html">Manual model testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/02_model_stage2/04_run_script_stage2.html">Run script</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_stroke/03_comparison.html">Model output comparison</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_stroke/04_asu_rehab_prompts.html">Prompts stage 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/01_iteration.html">Iteration 1: Acute Stroke Unit Arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/02_iteration.html">Iteration 2: Post stroke unit destination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/03_iteration.html">Iteration 3: Sample length of stay on the ASU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/04_iteration.html">Iteration 4: Fix the sampling from lognormal distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/05_iteration.html">Iteration 5: organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/06_iteration.html">Iteration 6: add in a count of occupancy.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/07_iteration.html">Iteration 7: a trace function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/08_iteration.html">Iteration 8: auditing ASU occupancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/09_iteration.html">Iteration 9: ASU occupancy plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/10_iteration.html">Iteration 10: Blocking probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/11_iteration.html">Iteration 11: Return missing code</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/12_iteration.html">Iteration 12: External Rehab arrivals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/13_iteration.html">Iteration 13: Organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/14_iteration.html">Iteration 14: Rehab treatment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/15_iteration.html">Iteration 15: Organise parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/16_iteration.html">Iteration 16: TIA rehab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/17_iteration.html">Iteration 17: Count occupancy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/18_iteration.html">Iteration 18: Audit Rehab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/19_iteration.html">Iteration 19: Link models (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/20_iteration.html">Iteration 20: Link models (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/21_iteration.html">Iteration 21: Warm-up period</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/22_iteration.html">Iteration 22: Multiple Replications (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/23_iteration.html">Iteration 23: Multiple Replications (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/24_iteration.html">Iteration 24: Common Random Numbers (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/25_iteration.html">Iteration 25: Common Random Numbers (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/26_iteration.html">Iteration 26: Common Random Numbers (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/27_iteration.html">Iteration 27: Common Random Numbers (4)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/28_iteration.html">Iteration 28: streamlit (1)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/29_iteration.html">Iteration 29: streamlit (2)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/30_iteration.html">Iteration 30: streamlit (3)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/04_prompts_stage1/31_iteration.html">Iteration 30: Bug fix</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_stroke/05_asu_rehab_prompts_stage2.html">Prompts stage 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/01_iteration_s2.html">Iteration 1: Acute Stroke Unit Arrivals stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/02_iteration_s2.html">Iteration 2: Post stroke unit destination stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/03_iteration_s2.html">Iteration 3: Sample length of stay on the ASU stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/04_iteration_s2.html">Iteration 4: Check the sampling from lognormal distributions stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/05_iteration_s2.html">Iteration 5: organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/06_iteration_s2.html">Iteration 6: add in a count of occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/07_iteration_s2.html">Iteration 7: a trace function stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/08_iteration_s2.html">Iteration 8: auditing ASU occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/09_iteration_s2.html">Iteration 9: ASU occupancy plot stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/10_iteration_s2.html">Iteration 10: Blocking probability stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/11_iteration_s2.html">Iteration 11: Return missing code stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/12_iteration_s2.html">Iteration 12: External Rehab arrivals stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/13_iteration_s2.html">Iteration 13: Organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/14_iteration_s2.html">Iteration 14: Rehab treatment stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/15_iteration_s2.html">Iteration 15: Organise parameters stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/16_iteration_s2.html">Iteration 16: TIA rehab stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/17_iteration_s2.html">Iteration 17: Count occupancy stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/18_iteration_s2.html">Iteration 18: Audit Rehab stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/19_iteration_s2.html">Iteration 19: Link models (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/20_iteration_s2.html">Iteration 20: Link models (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/21_iteration_s2.html">Iteration 21: Warm-up period stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/22_iteration_s2.html">Iteration 22: Multiple Replications (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/23_iteration_s2.html">Iteration 23: Multiple Replications (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/24_iteration_s2.html">Iteration 24: Common Random Numbers (1) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/25_iteration_s2.html">Iteration 25: Common Random Numbers (2) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/26_iteration_s2.html">Iteration 26: Common Random Numbers (3) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/27_iteration_s2.html">Iteration 27: Common Random Numbers (4) stage 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/28_iteration_s2.html">Iteration 28: streamlit (1) stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/29_iteration_s2.html">Iteration 29: streamlit (2) stage 2</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/30_iteration_s2.html">Iteration 30: streamlit (3)</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../03_stroke/05_prompts_stage2/31_iteration_s2.html">Iteration 30: Bug fix</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Results</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../04_results/01_CCU/00_model_comparison.html">CCU models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_results/02_stroke/00_model_comparison.html">Stroke+Rehab models</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/pythonhealthdatascience/llm_simpy/main?urlpath=lab/tree/notebooks/02_CCU/01_model_stage1/06_sensitivity_analysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pythonhealthdatascience/llm_simpy" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pythonhealthdatascience/llm_simpy/issues/new?title=Issue%20on%20page%20%2Fnotebooks/02_CCU/01_model_stage1/06_sensitivity_analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/02_CCU/01_model_stage1/06_sensitivity_analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sensitivity Analysis Script</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-analysis-conducted">Summary of analysis conducted</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-analysis-of-elective-operations-inter-arrival-mean">One-way analysis of elective operations inter-arrival mean</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-analysis-of-length-of-stay-means-for-a-e-ward-emergency-and-elective-patients">One-way analysis of Length of Stay means for A&amp;E, Ward, Emergency, and Elective Patients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-analysis-of-elective-parameters">Two way analysis of elective parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-imports">General imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-imports">Model imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-1-a-one-way-sensitivity-analysis-of-elective-arrivals">Analysis 1: A one-way sensitivity analysis of elective arrivals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-2-one-way-analysis-of-length-of-stay-tornado-plots">Analysis 2: One-way analysis of length of stay (tornado plots)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-3-two-way-sensitivity-analysis">Analysis 3: Two-way sensitivity analysis</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sensitivity-analysis-script">
<h1>Sensitivity Analysis Script<a class="headerlink" href="#sensitivity-analysis-script" title="Link to this heading">#</a></h1>
<blockquote>
<div><p><strong>Transparency Note:</strong> This notebook reports an analysis conducted as part of the <strong>peer review</strong> an article reporting the work.  <strong>In summary, the findings of this sensitivity analysis do not alter the conclusions of our study. We were not able to replicate the results report, and there were no errors in the model generated using the LLM.</strong></p>
</div></blockquote>
<p>During the peer review of this work for the Journal of Simulation, a reviewer asked us to conduct a sensitivity analysis. This was because the results of our CCU model were different from the original journal article. There was a possibility that small changes in the parameters may calibrate the results between our recreation and the original model.</p>
<p>During our study there were three key sources of uncertainty in the reporting of the model:</p>
<ol class="arabic simple">
<li><p>The empirical distribution of elective inter-arrival times is not provided.</p></li>
<li><p>The empirical distribution (resampling of raw data) for elective length of stay in the CCU is not provided.</p></li>
<li><p>A&amp;E, Ward, and Emergency Surgery patients length of stay are reported to fit both a Lognormal (parameters available) and n-stage HyperExponential (parameters unavailable) distributions.</p></li>
</ol>
<section id="summary-of-analysis-conducted">
<h2>Summary of analysis conducted<a class="headerlink" href="#summary-of-analysis-conducted" title="Link to this heading">#</a></h2>
<p>In response, we performed three types of analysis:</p>
<section id="one-way-analysis-of-elective-operations-inter-arrival-mean">
<h3>One-way analysis of elective operations inter-arrival mean<a class="headerlink" href="#one-way-analysis-of-elective-operations-inter-arrival-mean" title="Link to this heading">#</a></h3>
<p>In the original study the elective arrival process was modelled as an empirical distribution.  We could not determine if original model resampled the raw data directly or if an empirical distribution was constructed. An image of a relative frequency histogram of the elective arrivals is provided in the text, but the raw data behind it are not available. The authors state that a Normal Distribution with mean 17.91 and stdev 3.16 could be used as an alternative and we were unclear if this was the actual approach used in the original model or if the empirical distribution was indeed used.  The authors also state an expected number of elective patients at approximately 30 per month - or 360 per year (i.e. approximately 1 patient per day).</p>
<p>When implemented in our model this resulted in an average of 1650 arrivals in total (n = 5 replications). This is in line with expectations for the parameters available in the original journal article. See table below. Note that the number of elective patients is higher than the 360 expected.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Source</strong></p></th>
<th class="head"><p><strong>IAT</strong></p></th>
<th class="head"><p><strong>Rate/day</strong></p></th>
<th class="head"><p><strong>Rate/year</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A&amp;E</p></td>
<td><p>22.72</p></td>
<td><p>1.06</p></td>
<td><p>385.56</p></td>
</tr>
<tr class="row-odd"><td><p>Ward</p></td>
<td><p>26.00</p></td>
<td><p>0.92</p></td>
<td><p>336.92</p></td>
</tr>
<tr class="row-even"><td><p>Emergency</p></td>
<td><p>37.00</p></td>
<td><p>0.65</p></td>
<td><p>236.76</p></td>
</tr>
<tr class="row-odd"><td><p>Other hospital</p></td>
<td><p>47.20</p></td>
<td><p>0.51</p></td>
<td><p>185.59</p></td>
</tr>
<tr class="row-even"><td><p>X-ray</p></td>
<td><p>575.00</p></td>
<td><p>0.04</p></td>
<td><p>15.23</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Unplanned Total</strong></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p><strong>1160.07</strong></p></td>
</tr>
<tr class="row-even"><td><p>Electives</p></td>
<td><p>17.91</p></td>
<td><p>1.34</p></td>
<td><p>489.11</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Expected demand</strong></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p><strong>1649.2</strong></p></td>
</tr>
</tbody>
</table>
</div>
<p>The original article quotes an annual number of <strong>admissions</strong> as 1341 and in a 24 bed scenario a total of 57 elective cancellations. If we are distinguishing between arrivals and admissions this gives a total number of arrivals of approximately 1400 i.e. 250 less than the parameters we have included.</p>
<p>To explore this issue, we examined the one-way sensitivity of the model to mean of the Normal distribution used. The result is that to get to the required number of arrivals the mean inter-arrival time is required to be approximately doubled.e. to over 35 hours.</p>
</section>
<section id="one-way-analysis-of-length-of-stay-means-for-a-e-ward-emergency-and-elective-patients">
<h3>One-way analysis of Length of Stay means for A&amp;E, Ward, Emergency, and Elective Patients<a class="headerlink" href="#one-way-analysis-of-length-of-stay-means-for-a-e-ward-emergency-and-elective-patients" title="Link to this heading">#</a></h3>
<p>The authors state that they chose Lognormal distributions for Length of Stay for A&amp;E, Ward, and Emergency, but also that 3 and 4 stage HyperExponential distributions fit.  They authors only provide mean and stdev and not the parameters of the HyperExponential. We therefore chose to use Lognormals in our recreation.  In the article Elective LoS is modelled by resampling from the raw data, but these data are not provided as supplementary material. However, the mean and standard deviation is provided. We therefore opted to use a Lognormal again.  We varied the mean of these distribution by +- 50%.  Our conclusions remained the same. The results were not reproduced.</p>
</section>
<section id="two-way-analysis-of-elective-parameters">
<h3>Two way analysis of elective parameters<a class="headerlink" href="#two-way-analysis-of-elective-parameters" title="Link to this heading">#</a></h3>
<p>We simultaneously varied elective inter-arrival times (20 up to 55 hrs) and elective LoS mean (+- 30).  The model is sensitive to an simultaneous increase in elective IAT and reduction in LoS.  But it does not get close to replicating results within reasonable values.  For example, elective operations are still above 100 with a doubled IAT. We suspect the main issue here is the shape of the distributions chosen.  Our conclusion is that the lognormal distribution is a poor fit for elective length stay.</p>
</section>
</section>
<section id="general-imports">
<h2>General imports<a class="headerlink" href="#general-imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-imports">
<h2>Model imports<a class="headerlink" href="#model-imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ccu_formatted_code</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Experiment</span><span class="p">,</span>
    <span class="n">multiple_replications</span><span class="p">,</span>
    <span class="n">results_summary</span><span class="p">,</span>
    <span class="n">get_experiments</span><span class="p">,</span>
    <span class="n">run_all_experiments</span><span class="p">,</span>
    <span class="n">summary_of_experiments</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-1-a-one-way-sensitivity-analysis-of-elective-arrivals">
<h2>Analysis 1: A one-way sensitivity analysis of elective arrivals<a class="headerlink" href="#analysis-1-a-one-way-sensitivity-analysis-of-elective-arrivals" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_sensitivity_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run sensitivity analysis on elective inter-arrival time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define the range of elective inter-arrival times</span>
    <span class="n">elective_iat_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>  <span class="c1"># [20, 25, 30, 35]</span>

    <span class="c1"># Store results for each experiment</span>
    <span class="n">sensitivity_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting sensitivity analysis...&quot;</span><span class="p">)</span>

    <span class="c1"># Run the model for each elective inter-arrival time</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">iat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elective_iat_values</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running experiment </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">elective_iat_values</span><span class="p">)</span><span class="si">}</span><span class="s2">: Elective IAT = </span><span class="si">{</span><span class="n">iat</span><span class="si">}</span><span class="s2"> hours&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Create experiment with 24 beds and updated elective inter-arrival time</span>
        <span class="c1"># Index 5 in interarrival_means corresponds to elective surgery</span>
        <span class="n">interarrival_means</span> <span class="o">=</span> <span class="p">[</span><span class="mf">22.72</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">47.2</span><span class="p">,</span> <span class="mf">575.0</span><span class="p">,</span> <span class="n">iat</span><span class="p">]</span>

        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
            <span class="n">num_critical_care_beds</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">interarrival_means</span><span class="o">=</span><span class="n">interarrival_means</span>
        <span class="p">)</span>

        <span class="c1"># Run 100 replications</span>
        <span class="n">replications</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Summarize results</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">results_summary</span><span class="p">(</span><span class="n">replications</span><span class="p">)</span>

        <span class="c1"># Add the elective IAT value to the summary</span>
        <span class="n">summary_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Elective_IAT&quot;</span><span class="p">:</span> <span class="n">iat</span><span class="p">,</span>
            <span class="s2">&quot;Cancelled_Elective_Operations_Mean&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Cancelled_Elective_Operations_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Bed_Occupancy_Mean&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Bed_Occupancy_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Patient_Count_Mean&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Patient_Count_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Bed_Utilization_Mean&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Bed_Utilization_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Mean_Waiting_Time_Unplanned_Mean&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Mean_Waiting_Time_Unplanned_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
            <span class="p">],</span>
        <span class="p">}</span>

        <span class="n">sensitivity_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_dict</span><span class="p">)</span>

    <span class="c1"># Convert to DataFrame</span>
    <span class="n">sensitivity_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sensitivity_results</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sensitivity analysis complete!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sensitivity_df</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_sensitivity_charts</span><span class="p">(</span><span class="n">sensitivity_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create three charts showing sensitivity analysis results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Griffith&#39;s reference values</span>
    <span class="n">griffith_cancelled_ops</span> <span class="o">=</span> <span class="mi">57</span>
    <span class="n">griffith_bed_occupancy</span> <span class="o">=</span> <span class="mf">19.76</span>
    <span class="n">griffith_patient_count</span> <span class="o">=</span> <span class="mi">1400</span>

    <span class="c1"># Create figure with 3 subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Sensitivity Analysis: Elective Inter-Arrival Time&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Chart 1: Cancelled Elective Operations</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Cancelled_Elective_Operations_Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;bo-&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Cancelled_Elective_Operations_Mean&quot;</span><span class="p">]</span>
        <span class="o">-</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Cancelled_Elective_Operations_Std&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Cancelled_Elective_Operations_Mean&quot;</span><span class="p">]</span>
        <span class="o">+</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Cancelled_Elective_Operations_Std&quot;</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">griffith_cancelled_ops</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Griffith&#39;s result&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Elective Inter-Arrival Time (hrs)&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Chart 2: Bed Occupancy</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Bed_Occupancy_Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;go-&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Bed_Occupancy_Mean&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Bed_Occupancy_Std&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Bed_Occupancy_Mean&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Bed_Occupancy_Std&quot;</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">griffith_bed_occupancy</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Griffith&#39;s result&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Elective Inter-Arrival Time (hrs)&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># Chart 3: Patient Count</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Patient_Count_Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;mo-&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Patient_Count_Mean&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Patient_Count_Std&quot;</span><span class="p">],</span>
        <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Patient_Count_Mean&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Patient_Count_Std&quot;</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="n">griffith_patient_count</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Griffith&#39;s result&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Elective Inter-Arrival Time (hrs)&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run sensitivity analysis</span>
<span class="n">sensitivity_results</span> <span class="o">=</span> <span class="n">run_sensitivity_analysis</span><span class="p">()</span>

<span class="c1"># Display results table</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SENSITIVITY ANALYSIS RESULTS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">sensitivity_results</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting sensitivity analysis...
Running experiment 1/7: Elective IAT = 20 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 2/7: Elective IAT = 25 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 3/7: Elective IAT = 30 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 4/7: Elective IAT = 35 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 5/7: Elective IAT = 40 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 6/7: Elective IAT = 45 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 7/7: Elective IAT = 50 hours
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sensitivity analysis complete!

================================================================================
SENSITIVITY ANALYSIS RESULTS
================================================================================
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Elective_IAT</th>
      <th>Cancelled_Elective_Operations_Mean</th>
      <th>Cancelled_Elective_Operations_Std</th>
      <th>Bed_Occupancy_Mean</th>
      <th>Bed_Occupancy_Std</th>
      <th>Patient_Count_Mean</th>
      <th>Patient_Count_Std</th>
      <th>Bed_Utilization_Mean</th>
      <th>Bed_Utilization_Std</th>
      <th>Mean_Waiting_Time_Unplanned_Mean</th>
      <th>Mean_Waiting_Time_Unplanned_Std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20</td>
      <td>259.14</td>
      <td>67.54</td>
      <td>21.31</td>
      <td>0.80</td>
      <td>1576.71</td>
      <td>35.20</td>
      <td>0.89</td>
      <td>0.03</td>
      <td>46.88</td>
      <td>51.47</td>
    </tr>
    <tr>
      <th>1</th>
      <td>25</td>
      <td>200.07</td>
      <td>56.03</td>
      <td>21.13</td>
      <td>0.86</td>
      <td>1490.40</td>
      <td>35.34</td>
      <td>0.88</td>
      <td>0.04</td>
      <td>45.81</td>
      <td>50.87</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>161.82</td>
      <td>47.69</td>
      <td>21.00</td>
      <td>0.90</td>
      <td>1432.85</td>
      <td>35.22</td>
      <td>0.88</td>
      <td>0.04</td>
      <td>45.31</td>
      <td>51.03</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35</td>
      <td>135.65</td>
      <td>41.89</td>
      <td>20.90</td>
      <td>0.94</td>
      <td>1391.75</td>
      <td>35.22</td>
      <td>0.87</td>
      <td>0.04</td>
      <td>44.77</td>
      <td>50.82</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>116.77</td>
      <td>36.80</td>
      <td>20.83</td>
      <td>0.97</td>
      <td>1361.08</td>
      <td>35.19</td>
      <td>0.87</td>
      <td>0.04</td>
      <td>44.62</td>
      <td>51.15</td>
    </tr>
    <tr>
      <th>5</th>
      <td>45</td>
      <td>102.59</td>
      <td>33.27</td>
      <td>20.76</td>
      <td>0.99</td>
      <td>1337.03</td>
      <td>35.23</td>
      <td>0.86</td>
      <td>0.04</td>
      <td>44.43</td>
      <td>51.76</td>
    </tr>
    <tr>
      <th>6</th>
      <td>50</td>
      <td>91.92</td>
      <td>30.00</td>
      <td>20.71</td>
      <td>1.01</td>
      <td>1317.75</td>
      <td>35.25</td>
      <td>0.86</td>
      <td>0.04</td>
      <td>44.19</td>
      <td>51.25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and display charts</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating sensitivity charts...&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">create_sensitivity_charts</span><span class="p">(</span><span class="n">sensitivity_results</span><span class="p">)</span>

<span class="c1"># Save results to CSV</span>
<span class="n">sensitivity_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis_results.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Results saved to &#39;sensitivity_analysis_results.csv&#39;&quot;</span><span class="p">)</span>

<span class="c1"># Save charts</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;sensitivity_analysis_charts.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Charts saved to &#39;sensitivity_analysis_charts.png&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating sensitivity charts...
</pre></div>
</div>
<img alt="../../../_images/d6b212b61083232be3a6178ea5f9b80036ae944df7082656ef78c9ecb44069b3.png" src="../../../_images/d6b212b61083232be3a6178ea5f9b80036ae944df7082656ef78c9ecb44069b3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results saved to &#39;sensitivity_analysis_results.csv&#39;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Charts saved to &#39;sensitivity_analysis_charts.png&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-2-one-way-analysis-of-length-of-stay-tornado-plots">
<h2>Analysis 2: One-way analysis of length of stay (tornado plots)<a class="headerlink" href="#analysis-2-one-way-analysis-of-length-of-stay-tornado-plots" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">length_of_stay_sensitivity_parameters</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the length of stay parameters and their ranges for sensitivity analysis</span>
<span class="sd">    Focus on A&amp;E, Ward, Emergency surgery, and Elective surgery length of stay means</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Base case parameters</span>
    <span class="n">base_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;interarrival_means&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">22.72</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">47.2</span><span class="p">,</span> <span class="mf">575.0</span><span class="p">,</span> <span class="mf">17.91</span><span class="p">],</span>
        <span class="s2">&quot;stay_distributions&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">128.79</span><span class="p">,</span> <span class="mf">267.51</span><span class="p">),</span>  <span class="c1"># A&amp;E - index 0</span>
            <span class="p">(</span><span class="mf">177.89</span><span class="p">,</span> <span class="mf">276.54</span><span class="p">),</span>  <span class="c1"># Ward - index 1</span>
            <span class="p">(</span><span class="mf">140.15</span><span class="p">,</span> <span class="mf">218.02</span><span class="p">),</span>  <span class="c1"># Emergency surgery - index 2</span>
            <span class="p">(</span><span class="mf">212.86</span><span class="p">,</span> <span class="mf">457.67</span><span class="p">),</span>  <span class="c1"># Other hospitals - index 3</span>
            <span class="p">(</span><span class="mf">87.53</span><span class="p">,</span> <span class="mf">108.67</span><span class="p">),</span>  <span class="c1"># X-ray - index 4</span>
            <span class="mf">57.34</span><span class="p">,</span>  <span class="c1"># Elective surgery - index 5 (not used in stay_distributions)</span>
        <span class="p">],</span>
        <span class="s2">&quot;num_critical_care_beds&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
        <span class="s2">&quot;intensive_cleaning_duration&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">:</span> <span class="mf">57.34</span><span class="p">,</span>  <span class="c1"># Elective surgery LOS mean</span>
    <span class="p">}</span>

    <span class="c1"># Parameter ranges for sensitivity analysis (25% variation in mean length of stay)</span>
    <span class="n">param_ranges</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;AE_LOS_mean&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span>
        <span class="p">],</span>  <span class="c1"># 96.6 to 160.99</span>
        <span class="s2">&quot;Ward_LOS_mean&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span>
        <span class="p">],</span>  <span class="c1"># 133.4 to 222.4</span>
        <span class="s2">&quot;Emergency_LOS_mean&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span>
        <span class="p">],</span>  <span class="c1"># 105.1 to 175.2</span>
        <span class="s2">&quot;Elective_LOS_mean&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.75</span><span class="p">,</span>
            <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">,</span>
        <span class="p">],</span>  <span class="c1"># 43.0 to 71.7</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">base_params</span><span class="p">,</span> <span class="n">param_ranges</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_experiment_with_los_param</span><span class="p">(</span><span class="n">base_params</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to create experiment with modified length of stay parameter&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">base_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_stay_distributions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;AE_LOS_mean&quot;</span><span class="p">:</span>
        <span class="c1"># Modify A&amp;E length of stay mean, keep std deviation same</span>
        <span class="n">new_stay_distributions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;Ward_LOS_mean&quot;</span><span class="p">:</span>
        <span class="c1"># Modify Ward length of stay mean, keep std deviation same</span>
        <span class="n">new_stay_distributions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;Emergency_LOS_mean&quot;</span><span class="p">:</span>
        <span class="c1"># Modify Emergency surgery length of stay mean, keep std deviation same</span>
        <span class="n">new_stay_distributions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">param_name</span> <span class="o">==</span> <span class="s2">&quot;Elective_LOS_mean&quot;</span><span class="p">:</span>
        <span class="c1"># Modify Elective surgery length of stay mean</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_stay_distributions</span>

    <span class="k">return</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">interarrival_means</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;interarrival_means&quot;</span><span class="p">],</span>
        <span class="n">stay_distributions</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">],</span>
        <span class="n">num_critical_care_beds</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;num_critical_care_beds&quot;</span><span class="p">],</span>
        <span class="n">intensive_cleaning_duration</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;intensive_cleaning_duration&quot;</span><span class="p">],</span>
        <span class="n">elective_treatment_mean</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">],</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">los_sensitivity_analysis</span><span class="p">(</span><span class="n">base_params</span><span class="p">,</span> <span class="n">param_ranges</span><span class="p">,</span> <span class="n">num_replications</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conduct sensitivity analysis on length of stay parameters including elective</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Base case</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running base case...&quot;</span><span class="p">)</span>
    <span class="n">base_experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
        <span class="n">interarrival_means</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;interarrival_means&quot;</span><span class="p">],</span>
        <span class="n">stay_distributions</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">],</span>
        <span class="n">num_critical_care_beds</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;num_critical_care_beds&quot;</span><span class="p">],</span>
        <span class="n">intensive_cleaning_duration</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;intensive_cleaning_duration&quot;</span><span class="p">],</span>
        <span class="n">elective_treatment_mean</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">base_results</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">base_experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="p">)</span>
    <span class="n">base_summary</span> <span class="o">=</span> <span class="n">results_summary</span><span class="p">(</span><span class="n">base_results</span><span class="p">)</span>

    <span class="c1"># Store base case</span>
    <span class="n">base_case</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;Base Case&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Base&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOS_Value&quot;</span><span class="p">:</span> <span class="s2">&quot;Base&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Cancelled_Ops_Std&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Bed_Occupancy_Std&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Bed_Utilization_Std&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;Wait_Time&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Wait_Time_Std&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Patient_Count_Std&quot;</span><span class="p">:</span> <span class="n">base_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_case</span><span class="p">)</span>

    <span class="c1"># Test each length of stay parameter</span>
    <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="p">(</span><span class="n">low_val</span><span class="p">,</span> <span class="n">high_val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">param_ranges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Testing </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># Test low value</span>
        <span class="n">low_experiment</span> <span class="o">=</span> <span class="n">create_experiment_with_los_param</span><span class="p">(</span>
            <span class="n">base_params</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">low_val</span>
        <span class="p">)</span>
        <span class="n">low_results</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">low_experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="p">)</span>
        <span class="n">low_summary</span> <span class="o">=</span> <span class="n">results_summary</span><span class="p">(</span><span class="n">low_results</span><span class="p">)</span>

        <span class="c1"># Test high value</span>
        <span class="n">high_experiment</span> <span class="o">=</span> <span class="n">create_experiment_with_los_param</span><span class="p">(</span>
            <span class="n">base_params</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">high_val</span>
        <span class="p">)</span>
        <span class="n">high_results</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">high_experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="p">)</span>
        <span class="n">high_summary</span> <span class="o">=</span> <span class="n">results_summary</span><span class="p">(</span><span class="n">high_results</span><span class="p">)</span>

        <span class="c1"># Store results</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">summary</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">,</span> <span class="n">low_summary</span><span class="p">,</span> <span class="n">low_val</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">,</span> <span class="n">high_summary</span><span class="p">,</span> <span class="n">high_val</span><span class="p">),</span>
        <span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="n">param_name</span><span class="p">,</span>
                <span class="s2">&quot;Value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;LOS_Value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Cancelled_Ops_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Bed_Occupancy_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Bed_Utilization_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;Wait_Time&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Wait_Time_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;Patient_Count&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Patient_Count_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_los_tornado_plots</span><span class="p">(</span><span class="n">sensitivity_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create tornado plots for length of stay sensitivity analysis including elective</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get base case values</span>
    <span class="n">base_row</span> <span class="o">=</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Base Case&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">base_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">:</span> <span class="n">base_row</span><span class="p">[</span><span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">:</span> <span class="n">base_row</span><span class="p">[</span><span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">:</span> <span class="n">base_row</span><span class="p">[</span><span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Wait_Time&quot;</span><span class="p">:</span> <span class="n">base_row</span><span class="p">[</span><span class="s2">&quot;Wait_Time&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">:</span> <span class="n">base_row</span><span class="p">[</span><span class="s2">&quot;Patient_Count&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="c1"># Create tornado plot data</span>
    <span class="n">tornado_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s2">&quot;Base Case&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="n">param_data</span> <span class="o">=</span> <span class="n">sensitivity_df</span><span class="p">[</span><span class="n">sensitivity_df</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">param</span><span class="p">]</span>
        <span class="n">low_data</span> <span class="o">=</span> <span class="n">param_data</span><span class="p">[</span><span class="n">param_data</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Low&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">high_data</span> <span class="o">=</span> <span class="n">param_data</span><span class="p">[</span><span class="n">param_data</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">base_values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">low_effect</span> <span class="o">=</span> <span class="n">low_data</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_values</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span>
            <span class="n">high_effect</span> <span class="o">=</span> <span class="n">high_data</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">-</span> <span class="n">base_values</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span>

            <span class="n">tornado_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s2">&quot;LOS&quot;</span><span class="p">,</span> <span class="s2">&quot;Length of Stay&quot;</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;Metric&quot;</span><span class="p">:</span> <span class="n">metric</span><span class="p">,</span>  <span class="c1"># Keep original metric name for filtering</span>
                    <span class="s2">&quot;Low_Effect&quot;</span><span class="p">:</span> <span class="n">low_effect</span><span class="p">,</span>
                    <span class="s2">&quot;High_Effect&quot;</span><span class="p">:</span> <span class="n">high_effect</span><span class="p">,</span>
                    <span class="s2">&quot;Total_Effect&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">high_effect</span> <span class="o">-</span> <span class="n">low_effect</span><span class="p">),</span>
                    <span class="s2">&quot;Base_Value&quot;</span><span class="p">:</span> <span class="n">base_values</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span>
                    <span class="s2">&quot;Low_Value&quot;</span><span class="p">:</span> <span class="n">low_data</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span>
                    <span class="s2">&quot;High_Value&quot;</span><span class="p">:</span> <span class="n">high_data</span><span class="p">[</span><span class="n">metric</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>

    <span class="n">tornado_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tornado_data</span><span class="p">)</span>

    <span class="c1"># Create subplots for different metrics</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wait_Time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">metric_titles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mean Waiting Time (Unplanned)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">metric_titles</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Filter data for this metric</span>
            <span class="n">metric_data</span> <span class="o">=</span> <span class="n">tornado_df</span><span class="p">[</span><span class="n">tornado_df</span><span class="p">[</span><span class="s2">&quot;Metric&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Check if we have data for this metric</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metric_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: No data found for metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="mf">0.5</span><span class="p">,</span>
                    <span class="mf">0.5</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;No data for </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Sort by total effect</span>
            <span class="n">metric_data</span> <span class="o">=</span> <span class="n">metric_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Total_Effect&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metric_data</span><span class="p">))</span>

            <span class="c1"># Get base value for this metric</span>
            <span class="n">base_value</span> <span class="o">=</span> <span class="n">metric_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Base_Value&quot;</span><span class="p">]</span>

            <span class="c1"># Create bars</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metric_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
                <span class="c1"># Left bar (low effect)</span>
                <span class="n">left_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Low_Effect&quot;</span><span class="p">])</span>
                <span class="n">left_start</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_value</span> <span class="o">-</span> <span class="n">left_width</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Low_Effect&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">base_value</span>
                <span class="p">)</span>

                <span class="c1"># Right bar (high effect)</span>
                <span class="n">right_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;High_Effect&quot;</span><span class="p">])</span>
                <span class="n">right_start</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">base_value</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;High_Effect&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">base_value</span> <span class="o">-</span> <span class="n">right_width</span>
                <span class="p">)</span>

                <span class="c1"># Plot bars</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">,</span>
                    <span class="n">left_width</span><span class="p">,</span>
                    <span class="n">left</span><span class="o">=</span><span class="n">left_start</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightcoral&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Low (-25%)&quot;</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
                    <span class="n">j</span><span class="p">,</span>
                    <span class="n">right_width</span><span class="p">,</span>
                    <span class="n">left</span><span class="o">=</span><span class="n">right_start</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;High (+25%)&quot;</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Add base line</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                <span class="n">base_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Base Case&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Formatting</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">y_pos</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">metric_data</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sensitivity: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Remove unused subplot</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Length of Stay Sensitivity Analysis: Tornado Plots (Including Elective)&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">run_los_sensitivity_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run complete length of stay sensitivity analysis including elective</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Length of Stay Sensitivity Analysis...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Focusing on A&amp;E, Ward, Emergency, and Elective surgery length of stay means&quot;</span><span class="p">)</span>

    <span class="c1"># Get parameters</span>
    <span class="n">base_params</span><span class="p">,</span> <span class="n">param_ranges</span> <span class="o">=</span> <span class="n">length_of_stay_sensitivity_parameters</span><span class="p">()</span>

    <span class="c1"># Display parameter information</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Base case length of stay means:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A&amp;E: </span><span class="si">{</span><span class="n">base_params</span><span class="p">[</span><span class="s1">&#39;stay_distributions&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ward: </span><span class="si">{</span><span class="n">base_params</span><span class="p">[</span><span class="s1">&#39;stay_distributions&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emergency: </span><span class="si">{</span><span class="n">base_params</span><span class="p">[</span><span class="s1">&#39;stay_distributions&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elective: </span><span class="si">{</span><span class="n">base_params</span><span class="p">[</span><span class="s1">&#39;elective_treatment_mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Testing ranges (25%):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="p">(</span><span class="n">low_val</span><span class="p">,</span> <span class="n">high_val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">param_ranges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">low_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">high_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> hours&quot;</span><span class="p">)</span>

    <span class="c1"># Run sensitivity analysis</span>
    <span class="n">sensitivity_results</span> <span class="o">=</span> <span class="n">los_sensitivity_analysis</span><span class="p">(</span>
        <span class="n">base_params</span><span class="p">,</span> <span class="n">param_ranges</span><span class="p">,</span> <span class="n">num_replications</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">)</span>

    <span class="c1"># Display results table</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LENGTH OF STAY SENSITIVITY ANALYSIS RESULTS (INCLUDING ELECTIVE)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

    <span class="c1"># Create summary table</span>
    <span class="n">summary_cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Parameter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LOS_Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wait_Time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="n">summary_cols</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Create tornado plots</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating tornado plots...&quot;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">create_los_tornado_plots</span><span class="p">(</span><span class="n">sensitivity_results</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Save results</span>
    <span class="n">sensitivity_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="s2">&quot;los_sensitivity_analysis_with_elective_results.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;los_tornado_plots_with_elective.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis complete!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Results saved to &#39;los_sensitivity_analysis_with_elective_results.csv&#39;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tornado plots saved to &#39;los_tornado_plots_with_elective.png&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sensitivity_results</span>


<span class="c1"># Additional function to create a comparison table</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_los_comparison_table</span><span class="p">(</span><span class="n">sensitivity_results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a comparison table showing the effect of each LOS parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_row</span> <span class="o">=</span> <span class="n">sensitivity_results</span><span class="p">[</span>
        <span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Base Case&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">comparison_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s2">&quot;Base Case&quot;</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="n">param_data</span> <span class="o">=</span> <span class="n">sensitivity_results</span><span class="p">[</span><span class="n">sensitivity_results</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">param</span><span class="p">]</span>
        <span class="n">low_data</span> <span class="o">=</span> <span class="n">param_data</span><span class="p">[</span><span class="n">param_data</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Low&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">high_data</span> <span class="o">=</span> <span class="n">param_data</span><span class="p">[</span><span class="n">param_data</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;High&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">comparison_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Parameter&quot;</span><span class="p">:</span> <span class="n">param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;LOS&quot;</span><span class="p">,</span> <span class="s2">&quot;Length of Stay&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Base_LOS_hrs&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">base_row</span><span class="p">[</span><span class="s2">&quot;LOS_Value&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">param</span> <span class="o">!=</span> <span class="s2">&quot;Base Case&quot;</span> <span class="k">else</span> <span class="s2">&quot;Base&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Low_LOS_hrs&quot;</span><span class="p">:</span> <span class="n">low_data</span><span class="p">[</span><span class="s2">&quot;LOS_Value&quot;</span><span class="p">],</span>
                <span class="s2">&quot;High_LOS_hrs&quot;</span><span class="p">:</span> <span class="n">high_data</span><span class="p">[</span><span class="s2">&quot;LOS_Value&quot;</span><span class="p">],</span>
                <span class="s2">&quot;Low_Cancelled_Ops&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">low_data</span><span class="p">[</span><span class="s1">&#39;Cancelled_Ops&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">low_data</span><span class="p">[</span><span class="s1">&#39;Cancelled_Ops&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base_row</span><span class="p">[</span><span class="s1">&#39;Cancelled_Ops&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;High_Cancelled_Ops&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">high_data</span><span class="p">[</span><span class="s1">&#39;Cancelled_Ops&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">high_data</span><span class="p">[</span><span class="s1">&#39;Cancelled_Ops&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base_row</span><span class="p">[</span><span class="s1">&#39;Cancelled_Ops&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Low_Bed_Occupancy&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">low_data</span><span class="p">[</span><span class="s1">&#39;Bed_Occupancy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">low_data</span><span class="p">[</span><span class="s1">&#39;Bed_Occupancy&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base_row</span><span class="p">[</span><span class="s1">&#39;Bed_Occupancy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;High_Bed_Occupancy&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">high_data</span><span class="p">[</span><span class="s1">&#39;Bed_Occupancy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">high_data</span><span class="p">[</span><span class="s1">&#39;Bed_Occupancy&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">base_row</span><span class="p">[</span><span class="s1">&#39;Bed_Occupancy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">comparison_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run the analysis</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">run_los_sensitivity_analysis</span><span class="p">()</span>

<span class="c1"># Create and display comparison table</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PARAMETER COMPARISON TABLE&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">comparison_table</span> <span class="o">=</span> <span class="n">create_los_comparison_table</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">comparison_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting Length of Stay Sensitivity Analysis...
Focusing on A&amp;E, Ward, Emergency, and Elective surgery length of stay means

Base case length of stay means:
A&amp;E: 128.8 hours
Ward: 177.9 hours
Emergency: 140.2 hours
Elective: 57.3 hours

Testing ranges (25%):
AE_LOS_mean: 96.6 to 161.0 hours
Ward_LOS_mean: 133.4 to 222.4 hours
Emergency_LOS_mean: 105.1 to 175.2 hours
Elective_LOS_mean: 43.0 to 71.7 hours
Running base case...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing AE_LOS_mean...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing Ward_LOS_mean...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing Emergency_LOS_mean...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testing Elective_LOS_mean...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>================================================================================
LENGTH OF STAY SENSITIVITY ANALYSIS RESULTS (INCLUDING ELECTIVE)
================================================================================
            Parameter Value LOS_Value  Cancelled_Ops  Bed_Occupancy  \
0           Base Case  Base      Base         294.91          21.42   
1         AE_LOS_mean   Low      96.6         218.01          20.61   
2         AE_LOS_mean  High     161.0         369.39          22.09   
3       Ward_LOS_mean   Low     133.4         202.17          20.42   
4       Ward_LOS_mean  High     222.4         383.27          22.21   
5  Emergency_LOS_mean   Low     105.1         241.96          20.88   
6  Emergency_LOS_mean  High     175.2         345.98          21.89   
7   Elective_LOS_mean   Low      43.0         280.34          21.17   
8   Elective_LOS_mean  High      71.7         309.08          21.62   

   Bed_Utilization  Wait_Time  Patient_Count  
0             0.89      46.93        1627.12  
1             0.86      21.11        1627.12  
2             0.92     104.55        1627.12  
3             0.85      18.14        1627.12  
4             0.93     122.44        1627.12  
5             0.87      27.48        1627.12  
6             0.91      81.59        1627.12  
7             0.88      45.50        1627.12  
8             0.90      48.73        1627.12  

Creating tornado plots...
</pre></div>
</div>
<img alt="../../../_images/ca57967e4db12e55a561b2587e37e9b2a4653497baac9b829b2bdb16ce79bc1b.png" src="../../../_images/ca57967e4db12e55a561b2587e37e9b2a4653497baac9b829b2bdb16ce79bc1b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analysis complete!
Results saved to &#39;los_sensitivity_analysis_with_elective_results.csv&#39;
Tornado plots saved to &#39;los_tornado_plots_with_elective.png&#39;

====================================================================================================
PARAMETER COMPARISON TABLE
====================================================================================================
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Parameter</th>
      <th>Base_LOS_hrs</th>
      <th>Low_LOS_hrs</th>
      <th>High_LOS_hrs</th>
      <th>Low_Cancelled_Ops</th>
      <th>High_Cancelled_Ops</th>
      <th>Low_Bed_Occupancy</th>
      <th>High_Bed_Occupancy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AE Length of Stay mean</td>
      <td>Base</td>
      <td>96.6</td>
      <td>161.0</td>
      <td>218.0 (-76.9)</td>
      <td>369.4 (+74.5)</td>
      <td>20.6 (-0.8)</td>
      <td>22.1 (+0.7)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ward Length of Stay mean</td>
      <td>Base</td>
      <td>133.4</td>
      <td>222.4</td>
      <td>202.2 (-92.7)</td>
      <td>383.3 (+88.4)</td>
      <td>20.4 (-1.0)</td>
      <td>22.2 (+0.8)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Emergency Length of Stay mean</td>
      <td>Base</td>
      <td>105.1</td>
      <td>175.2</td>
      <td>242.0 (-53.0)</td>
      <td>346.0 (+51.1)</td>
      <td>20.9 (-0.5)</td>
      <td>21.9 (+0.5)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Elective Length of Stay mean</td>
      <td>Base</td>
      <td>43.0</td>
      <td>71.7</td>
      <td>280.3 (-14.6)</td>
      <td>309.1 (+14.2)</td>
      <td>21.2 (-0.2)</td>
      <td>21.6 (+0.2)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="analysis-3-two-way-sensitivity-analysis">
<h2>Analysis 3: Two-way sensitivity analysis<a class="headerlink" href="#analysis-3-two-way-sensitivity-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">two_way_sensitivity_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2-way sensitivity analysis: Elective inter-arrival time vs Elective length of stay</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define parameter ranges</span>
    <span class="c1"># Elective inter-arrival time: increase only (reduce patient volume)</span>
    <span class="n">elective_iat_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># [18, 21, 24, 27, 30, 33] hours</span>

    <span class="c1"># Elective length of stay: vary both ways (30%)</span>
    <span class="n">base_elective_los</span> <span class="o">=</span> <span class="mf">57.34</span>
    <span class="n">elective_los_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
        <span class="n">base_elective_los</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># 40.1 hours</span>
        <span class="n">base_elective_los</span> <span class="o">*</span> <span class="mf">1.3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># 79.5 hours</span>
        <span class="mi">6</span><span class="p">,</span>  <span class="c1"># step size</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2-Way Sensitivity Analysis: Elective IAT vs Elective LOS&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elective Inter-arrival Times: </span><span class="si">{</span><span class="n">elective_iat_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Elective Length of Stay: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">elective_los_values</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total combinations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">elective_iat_values</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">elective_los_values</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Base parameters</span>
    <span class="n">base_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;interarrival_means&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">22.72</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">47.2</span><span class="p">,</span> <span class="mf">575.0</span><span class="p">,</span> <span class="mf">17.91</span><span class="p">],</span>
        <span class="s2">&quot;stay_distributions&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">128.79</span><span class="p">,</span> <span class="mf">267.51</span><span class="p">),</span>  <span class="c1"># A&amp;E</span>
            <span class="p">(</span><span class="mf">177.89</span><span class="p">,</span> <span class="mf">276.54</span><span class="p">),</span>  <span class="c1"># Ward</span>
            <span class="p">(</span><span class="mf">140.15</span><span class="p">,</span> <span class="mf">218.02</span><span class="p">),</span>  <span class="c1"># Emergency surgery</span>
            <span class="p">(</span><span class="mf">212.86</span><span class="p">,</span> <span class="mf">457.67</span><span class="p">),</span>  <span class="c1"># Other hospitals</span>
            <span class="p">(</span><span class="mf">87.53</span><span class="p">,</span> <span class="mf">108.67</span><span class="p">),</span>  <span class="c1"># X-ray</span>
            <span class="mf">57.34</span><span class="p">,</span>  <span class="c1"># Elective surgery (not used in stay_distributions)</span>
        <span class="p">],</span>
        <span class="s2">&quot;num_critical_care_beds&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
        <span class="s2">&quot;intensive_cleaning_duration&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;elective_treatment_mean&quot;</span><span class="p">:</span> <span class="mf">57.34</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Store results</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Run experiments for all combinations</span>
    <span class="n">total_experiments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elective_iat_values</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">elective_los_values</span><span class="p">)</span>
    <span class="n">experiment_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">iat</span><span class="p">,</span> <span class="n">los</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">elective_iat_values</span><span class="p">,</span> <span class="n">elective_los_values</span><span class="p">):</span>
        <span class="n">experiment_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running experiment </span><span class="si">{</span><span class="n">experiment_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_experiments</span><span class="si">}</span><span class="s2">: IAT=</span><span class="si">{</span><span class="n">iat</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, LOS=</span><span class="si">{</span><span class="n">los</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Create modified parameters</span>
        <span class="n">modified_iat_means</span> <span class="o">=</span> <span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;interarrival_means&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">modified_iat_means</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">iat</span>  <span class="c1"># Update elective inter-arrival time</span>

        <span class="c1"># Create experiment</span>
        <span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
            <span class="n">interarrival_means</span><span class="o">=</span><span class="n">modified_iat_means</span><span class="p">,</span>
            <span class="n">stay_distributions</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;stay_distributions&quot;</span><span class="p">],</span>
            <span class="n">num_critical_care_beds</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;num_critical_care_beds&quot;</span><span class="p">],</span>
            <span class="n">intensive_cleaning_duration</span><span class="o">=</span><span class="n">base_params</span><span class="p">[</span><span class="s2">&quot;intensive_cleaning_duration&quot;</span><span class="p">],</span>
            <span class="n">elective_treatment_mean</span><span class="o">=</span><span class="n">los</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Run replications</span>
        <span class="n">replications</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">num_replications</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">results_summary</span><span class="p">(</span><span class="n">replications</span><span class="p">)</span>

        <span class="c1"># Store results</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Elective_IAT&quot;</span><span class="p">:</span> <span class="n">iat</span><span class="p">,</span>
            <span class="s2">&quot;Elective_LOS&quot;</span><span class="p">:</span> <span class="n">los</span><span class="p">,</span>
            <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Cancelled_Ops_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Bed_Occupancy_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Bed_Utilization_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Wait_Time&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Wait_Time_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s2">&quot;Mean Waiting Time Unplanned&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Patient_Count&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Mean&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Patient_Count_Std&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">),</span> <span class="n">elective_iat_values</span><span class="p">,</span> <span class="n">elective_los_values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_2way_heatmaps</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">iat_values</span><span class="p">,</span> <span class="n">los_values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create heatmaps for 2-way sensitivity analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Metrics to visualize</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wait_Time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">metric_titles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mean Waiting Time (Unplanned)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Create figure with subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Reference values (Griffith&#39;s results)</span>
    <span class="n">reference_values</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">:</span> <span class="mf">19.76</span><span class="p">,</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">:</span> <span class="mi">1400</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">metric_titles</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Create pivot table for heatmap</span>
            <span class="n">pivot_data</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Elective_LOS&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">metric</span>
            <span class="p">)</span>

            <span class="c1"># Create heatmap</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
                <span class="n">pivot_data</span><span class="p">,</span>
                <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.1f&quot;</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlBu_r&quot;</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="c1"># Add reference line if available</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">reference_values</span><span class="p">:</span>
                <span class="c1"># Add text annotation for reference value</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="mf">0.02</span><span class="p">,</span>
                    <span class="mf">0.98</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Griffith&#39;s: </span><span class="si">{</span><span class="n">reference_values</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Elective Inter-Arrival Time (hours)&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elective Length of Stay (hours)&quot;</span><span class="p">)</span>

    <span class="c1"># Remove unused subplot</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;2-Way Sensitivity Analysis: Elective Inter-Arrival Time vs Length of Stay&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_contour_plots</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">iat_values</span><span class="p">,</span> <span class="n">los_values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create contour plots for 2-way sensitivity analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Key metrics for contour plots</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">,</span> <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Patient_Count&quot;</span><span class="p">]</span>
    <span class="n">metric_titles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span> <span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span> <span class="s2">&quot;Patient Count&quot;</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># Create meshgrid for contour plots</span>
    <span class="n">IAT</span><span class="p">,</span> <span class="n">LOS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">iat_values</span><span class="p">,</span> <span class="n">los_values</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">metric_titles</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Create pivot table</span>
        <span class="n">pivot_data</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Elective_LOS&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Elective_IAT&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">metric</span>
        <span class="p">)</span>

        <span class="c1"># Create contour plot</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">IAT</span><span class="p">,</span> <span class="n">LOS</span><span class="p">,</span> <span class="n">pivot_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdYlBu_r&quot;</span><span class="p">)</span>
        <span class="n">contour_lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
            <span class="n">IAT</span><span class="p">,</span>
            <span class="n">LOS</span><span class="p">,</span>
            <span class="n">pivot_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add contour labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour_lines</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="c1"># Add colorbar</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Elective Inter-Arrival Time (hours)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elective Length of Stay (hours)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;2-Way Sensitivity Analysis: Contour Plots&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_summary_table</span><span class="p">(</span><span class="n">results_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create summary statistics table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">summary_stats</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Cancelled_Ops&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed_Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wait_Time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient_Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">metric_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Cancelled Elective Operations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed Occupancy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bed Utilization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mean Waiting Time (Unplanned)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Patient Count&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">):</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mean_val</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">std_val</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="c1"># Find conditions for min and max</span>
        <span class="n">min_condition</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_val</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_condition</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_val</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">summary_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Metric&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;Min_Value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Min_Condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;IAT=</span><span class="si">{</span><span class="n">min_condition</span><span class="p">[</span><span class="s1">&#39;Elective_IAT&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, LOS=</span><span class="si">{</span><span class="n">min_condition</span><span class="p">[</span><span class="s1">&#39;Elective_LOS&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Max_Value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Max_Condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;IAT=</span><span class="si">{</span><span class="n">max_condition</span><span class="p">[</span><span class="s1">&#39;Elective_IAT&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, LOS=</span><span class="si">{</span><span class="n">max_condition</span><span class="p">[</span><span class="s1">&#39;Elective_LOS&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Mean&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mean_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Std&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">std_val</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_stats</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_2way_sensitivity_analysis</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to run 2-way sensitivity analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting 2-Way Sensitivity Analysis...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take some time due to the number of combinations...&quot;</span><span class="p">)</span>

    <span class="c1"># Run the analysis</span>
    <span class="n">results_df</span><span class="p">,</span> <span class="n">iat_values</span><span class="p">,</span> <span class="n">los_values</span> <span class="o">=</span> <span class="n">two_way_sensitivity_analysis</span><span class="p">()</span>

    <span class="c1"># Create visualizations</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creating heatmaps...&quot;</span><span class="p">)</span>
    <span class="n">heatmap_fig</span> <span class="o">=</span> <span class="n">create_2way_heatmaps</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">iat_values</span><span class="p">,</span> <span class="n">los_values</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating contour plots...&quot;</span><span class="p">)</span>
    <span class="n">contour_fig</span> <span class="o">=</span> <span class="n">create_contour_plots</span><span class="p">(</span><span class="n">results_df</span><span class="p">,</span> <span class="n">iat_values</span><span class="p">,</span> <span class="n">los_values</span><span class="p">)</span>

    <span class="c1"># Create summary table</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating summary table...&quot;</span><span class="p">)</span>
    <span class="n">summary_table</span> <span class="o">=</span> <span class="n">create_summary_table</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2-WAY SENSITIVITY ANALYSIS SUMMARY&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">summary_table</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="c1"># Show plots</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Save results</span>
    <span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;2way_sensitivity_analysis_results.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">summary_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;2way_sensitivity_summary.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">heatmap_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;2way_sensitivity_heatmaps.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="n">contour_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;2way_sensitivity_contours.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis complete!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files saved:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- 2way_sensitivity_analysis_results.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- 2way_sensitivity_summary.csv&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- 2way_sensitivity_heatmaps.png&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- 2way_sensitivity_contours.png&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results_df</span><span class="p">,</span> <span class="n">summary_table</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">run_2way_sensitivity_analysis</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting 2-Way Sensitivity Analysis...
This may take some time due to the number of combinations...
2-Way Sensitivity Analysis: Elective IAT vs Elective LOS
Elective Inter-arrival Times: [20 25 30 35 40 45 50 55]
Elective Length of Stay: [17.2 23.2 29.2 35.2 41.2 47.2 53.2 59.2 65.2 71.2 77.2]
Total combinations: 88
Running experiment 1/88: IAT=20.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 2/88: IAT=20.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 3/88: IAT=20.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 4/88: IAT=20.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 5/88: IAT=20.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 6/88: IAT=20.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 7/88: IAT=20.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 8/88: IAT=20.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 9/88: IAT=20.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 10/88: IAT=20.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 11/88: IAT=20.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 12/88: IAT=25.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 13/88: IAT=25.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 14/88: IAT=25.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 15/88: IAT=25.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 16/88: IAT=25.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 17/88: IAT=25.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 18/88: IAT=25.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 19/88: IAT=25.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 20/88: IAT=25.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 21/88: IAT=25.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 22/88: IAT=25.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 23/88: IAT=30.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 24/88: IAT=30.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 25/88: IAT=30.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 26/88: IAT=30.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 27/88: IAT=30.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 28/88: IAT=30.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 29/88: IAT=30.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 30/88: IAT=30.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 31/88: IAT=30.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 32/88: IAT=30.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 33/88: IAT=30.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 34/88: IAT=35.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 35/88: IAT=35.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 36/88: IAT=35.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 37/88: IAT=35.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 38/88: IAT=35.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 39/88: IAT=35.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 40/88: IAT=35.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 41/88: IAT=35.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 42/88: IAT=35.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 43/88: IAT=35.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 44/88: IAT=35.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 45/88: IAT=40.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 46/88: IAT=40.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 47/88: IAT=40.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 48/88: IAT=40.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 49/88: IAT=40.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 50/88: IAT=40.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 51/88: IAT=40.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 52/88: IAT=40.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 53/88: IAT=40.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 54/88: IAT=40.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 55/88: IAT=40.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 56/88: IAT=45.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 57/88: IAT=45.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 58/88: IAT=45.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 59/88: IAT=45.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 60/88: IAT=45.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 61/88: IAT=45.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 62/88: IAT=45.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 63/88: IAT=45.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 64/88: IAT=45.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 65/88: IAT=45.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 66/88: IAT=45.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 67/88: IAT=50.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 68/88: IAT=50.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 69/88: IAT=50.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 70/88: IAT=50.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 71/88: IAT=50.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 72/88: IAT=50.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 73/88: IAT=50.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 74/88: IAT=50.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 75/88: IAT=50.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 76/88: IAT=50.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 77/88: IAT=50.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 78/88: IAT=55.0, LOS=17.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 79/88: IAT=55.0, LOS=23.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 80/88: IAT=55.0, LOS=29.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 81/88: IAT=55.0, LOS=35.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 82/88: IAT=55.0, LOS=41.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 83/88: IAT=55.0, LOS=47.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 84/88: IAT=55.0, LOS=53.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 85/88: IAT=55.0, LOS=59.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 86/88: IAT=55.0, LOS=65.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 87/88: IAT=55.0, LOS=71.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running experiment 88/88: IAT=55.0, LOS=77.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating heatmaps...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Creating contour plots...
Creating summary table...

====================================================================================================
2-WAY SENSITIVITY ANALYSIS SUMMARY
====================================================================================================
                       Metric Min_Value      Min_Condition Max_Value      Max_Condition   Mean  Std
Cancelled Elective Operations      76.3 IAT=55.0, LOS=17.2     271.9 IAT=20.0, LOS=77.2  137.8 54.3
                Bed Occupancy      20.3 IAT=55.0, LOS=17.2      21.6 IAT=20.0, LOS=77.2   20.8  0.3
              Bed Utilization       0.8 IAT=55.0, LOS=17.2       0.9 IAT=20.0, LOS=77.2    0.9  0.0
Mean Waiting Time (Unplanned)      36.2 IAT=55.0, LOS=17.2      43.3 IAT=20.0, LOS=77.2   38.4  1.6
                Patient Count    1301.8 IAT=55.0, LOS=17.2    1576.3 IAT=20.0, LOS=17.2 1400.9 88.7
</pre></div>
</div>
<img alt="../../../_images/5d8b8f3049ad62ae0723a02b604f374b053e13c6c6c94d55b75c575c4e74dd91.png" src="../../../_images/5d8b8f3049ad62ae0723a02b604f374b053e13c6c6c94d55b75c575c4e74dd91.png" />
<img alt="../../../_images/73b74da9f8d1b1f20ec205b568106dccbe989d0cbff1f19f98f916f606941dc9.png" src="../../../_images/73b74da9f8d1b1f20ec205b568106dccbe989d0cbff1f19f98f916f606941dc9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analysis complete!
Files saved:
- 2way_sensitivity_analysis_results.csv
- 2way_sensitivity_summary.csv
- 2way_sensitivity_heatmaps.png
- 2way_sensitivity_contours.png
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Metric</th>
      <th>Min_Value</th>
      <th>Min_Condition</th>
      <th>Max_Value</th>
      <th>Max_Condition</th>
      <th>Mean</th>
      <th>Std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cancelled Elective Operations</td>
      <td>76.3</td>
      <td>IAT=55.0, LOS=17.2</td>
      <td>271.9</td>
      <td>IAT=20.0, LOS=77.2</td>
      <td>137.8</td>
      <td>54.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bed Occupancy</td>
      <td>20.3</td>
      <td>IAT=55.0, LOS=17.2</td>
      <td>21.6</td>
      <td>IAT=20.0, LOS=77.2</td>
      <td>20.8</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bed Utilization</td>
      <td>0.8</td>
      <td>IAT=55.0, LOS=17.2</td>
      <td>0.9</td>
      <td>IAT=20.0, LOS=77.2</td>
      <td>0.9</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mean Waiting Time (Unplanned)</td>
      <td>36.2</td>
      <td>IAT=55.0, LOS=17.2</td>
      <td>43.3</td>
      <td>IAT=20.0, LOS=77.2</td>
      <td>38.4</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Patient Count</td>
      <td>1301.8</td>
      <td>IAT=55.0, LOS=17.2</td>
      <td>1576.3</td>
      <td>IAT=20.0, LOS=17.2</td>
      <td>1400.9</td>
      <td>88.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "pythonhealthdatascience/llm_simpy",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/02_CCU/01_model_stage1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="05_interface.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Streamlit interface</p>
      </div>
    </a>
    <a class="right-next"
       href="../02_model_stage2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model Stage 2</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-of-analysis-conducted">Summary of analysis conducted</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-analysis-of-elective-operations-inter-arrival-mean">One-way analysis of elective operations inter-arrival mean</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-way-analysis-of-length-of-stay-means-for-a-e-ward-emergency-and-elective-patients">One-way analysis of Length of Stay means for A&amp;E, Ward, Emergency, and Elective Patients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-way-analysis-of-elective-parameters">Two way analysis of elective parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-imports">General imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-imports">Model imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-1-a-one-way-sensitivity-analysis-of-elective-arrivals">Analysis 1: A one-way sensitivity analysis of elective arrivals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-2-one-way-analysis-of-length-of-stay-tornado-plots">Analysis 2: One-way analysis of length of stay (tornado plots)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-3-two-way-sensitivity-analysis">Analysis 3: Two-way sensitivity analysis</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>